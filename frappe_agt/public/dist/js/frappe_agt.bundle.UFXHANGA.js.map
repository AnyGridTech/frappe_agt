{
  "version": 3,
  "sources": ["../../../../../apps/frappe_agt/frappe_agt/public/ts/checklist/checklists.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/child_tracker_table/setup.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/namespace/namespaces.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/ui/enhanced_dialog.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/ui/ultra_dialog.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/utils/brazil/cnpj.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/utils/brazil/cpf.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/utils/brazil/cpf_cnpj.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/utils/brazil/cep.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/utils/brazil/phone.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/utils/text.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/utils/core.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/utils/db/index.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/utils/dialog.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/utils/doc.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/utils/form.ts", "../../../../../apps/frappe_agt/frappe_agt/public/ts/utils/table.ts"],
  "sourcesContent": ["import type { FrappeForm } from \"@anygridtech/frappe-types/client/frappe/core\";\r\n\r\n/*\r\n* This file handles the checklist functionality.\r\n* Read more: https://docs.frappe.io/framework/user/en/api/form#form-events\r\n*/\r\nfrappe.provide(\"agt.checklist\");\r\n\r\n// Implementa a interface Checklist definida nas tipagens\r\nagt.checklist = {\r\n  table: {\r\n    all: { setup: async () => {} },\r\n    inverter: { setup: async () => {} },\r\n    ev_charger: { setup: async () => {} },\r\n    battery: { setup: async () => {} },\r\n    transformer: { setup: async () => {} },\r\n    smart_meter: { setup: async () => {} },\r\n    smart_energy_manager: { setup: async () => {} },\r\n    datalogger: { setup: async () => {} }\r\n  },\r\n  tracker_table: {\r\n    all: { setup: async () => {} },\r\n    inverter: { setup: async () => {} },\r\n    ev_charger: { setup: async () => {} },\r\n    battery: { setup: async () => {} },\r\n    transformer: { setup: async () => {} },\r\n    smart_meter: { setup: async () => {} },\r\n    smart_energy_manager: { setup: async () => {} },\r\n    datalogger: { setup: async () => {} }\r\n  },\r\n  setup: async (): Promise<void> => {\r\n    // if (!growatt) return;\r\n    // growatt.src_frm = cur_frm;\r\n    frappe.ui.form.on(cur_frm.doctype, {\r\n      after_save: function (frm: FrappeForm) {\r\n        agt.utils.form.field.validate_js_visible_fields(frm, \"Customer Fix Info\").msgprint();\r\n      },\r\n      before_workflow_action: async function (frm: FrappeForm) {\r\n        if (frm.doc.__islocal) return;\r\n        const action = frm.states.frm.selected_workflow_action;\r\n        if (action === 'Encaminhar ao Suporte') {\r\n          agt.utils.form.field.validate_js_visible_fields(frm, \"Pre Analysis\").throw_error();\r\n        }\r\n        if (action === 'Concluir Checklist') {\r\n          agt.utils.form.field.validate_js_visible_fields(frm, \"Pre Analysis\").throw_error();\r\n          await trigger_checklist_finished_func(frm);\r\n        }\r\n        if (action === 'Rejeitar') {\r\n          agt.utils.update_workflow_state({\r\n            doctype: \"Service Protocol\",\r\n            docname: frm.doc['sp_docname'],\r\n            workflow_state: \"Holding Action\",\r\n            ignore_workflow_validation: true,\r\n          });\r\n        }\r\n        if (action === 'Solicitar Proposta de Envio') {\r\n          agt.utils.form.field.validate_js_visible_fields(frm, \"Pre Analysis\").throw_error();\r\n          await trigger_checklist_finished_func(frm);\r\n          await trigger_proposed_dispatch_func(frm);\r\n        }\r\n        return;\r\n      }\r\n    });\r\n\r\n    let trigger_proposed_dispatch = false;\r\n    const trigger_proposed_dispatch_func = async (frm: FrappeForm) => {\r\n      if (frm.doc.__islocal) return;\r\n\r\n      // Evita processamento m\u00FAltiplo simult\u00E2neo\r\n      if (trigger_proposed_dispatch) {\r\n        console.log('Requisi\u00E7\u00E3o em andamento, ignorando chamada...');\r\n        return;\r\n      }\r\n      trigger_proposed_dispatch = true;\r\n      try {\r\n        const swa = frm.states.frm.selected_workflow_action;\r\n        const swa_request_dispatch = \"Solicitar Proposta de Envio\";\r\n\r\n        if (swa !== swa_request_dispatch) {\r\n          throw new Error(\"A a\u00E7\u00E3o selecionada n\u00E3o permite criar uma Proposta de Envio.\");\r\n        }\r\n\r\n        const dt_name = \"Proposed Dispatch\";\r\n        // Verifica se j\u00E1 existe proposta vinculada\r\n        const existingDispatches = await frappe.db.get_list(dt_name, {\r\n          filters: { ticket_docname: frm.doc['ticket_docname'] },\r\n          fields: [\"name\"],\r\n        });\r\n        if (existingDispatches && existingDispatches.length > 0) {\r\n          const existing_list_html = existingDispatches.map(ticket => `<li>${ticket.name}</li>`).join(\"\");\r\n          throw new Error(`J\u00E1 existe uma Proposta de Envio vinculada a este Ticket: <br><ul>${existing_list_html}</ul>`);\r\n        }\r\n        // Checa novamente antes de criar\r\n        const freshDispatches = await frappe.db.get_list(dt_name, {\r\n          filters: { ticket_docname: frm.doc['ticket_docname'] },\r\n          fields: [\"name\"],\r\n        });\r\n        if (freshDispatches && freshDispatches.length > 0) return;\r\n\r\n        // Cria a Proposta de Envio\r\n        const docname = await agt.utils.doc.create_doc(dt_name, [\"ticket_docname\"], frm.fields_dict);\r\n        if (!docname) {\r\n          throw new Error(\"Falha ao criar Proposta de Envio.\");\r\n        }\r\n        console.log(\"Proposta de Envio criada com sucesso:\", docname);\r\n\r\n        // Adiciona linha na tabela 'proposed_dispatch_table'\r\n        const main_eqp_group = frm.doc['main_eqp_group'];\r\n        if (!main_eqp_group) {\r\n          throw new Error(\"Grupo do equipamento principal n\u00E3o definido.\");\r\n        }\r\n        await agt.utils.table.row.add_one(frm, \"proposed_dispatch_table\", {\r\n          item_name: main_eqp_group,\r\n          item_quantity: 1\r\n        });\r\n        frm.dirty();\r\n        console.log(\"Linha adicionada na tabela 'proposed_dispatch_table' com sucesso.\");\r\n        await frm.save();\r\n      } catch (error) {\r\n        console.error('Erro ao criar Proposta de Envio:', error);\r\n        frappe.msgprint({\r\n          title: \"Erro ao criar Proposta de Envio\",\r\n          message: error instanceof Error ? error.message : String(error),\r\n          indicator: 'red'\r\n        });\r\n      } finally {\r\n        trigger_proposed_dispatch = false;\r\n      }\r\n    };\r\n\r\n    let trigger_checklist_finished = false;\r\n    const trigger_checklist_finished_func = async (form: FrappeForm) => {\r\n      if (form.doc.__islocal) return;\r\n\r\n      // Evita processamento m\u00FAltiplo simult\u00E2neo\r\n      if (trigger_checklist_finished) {\r\n        console.log('Requisi\u00E7\u00E3o em andamento, ignorando chamada...');\r\n        return;\r\n      }\r\n      trigger_checklist_finished = true;\r\n      try {\r\n        agt.utils.update_workflow_state({\r\n          doctype: \"Service Protocol\",\r\n          docname: form.doc['sp_docname'],\r\n          workflow_state: \"Finished\",\r\n          ignore_workflow_validation: true,\r\n        });\r\n        frappe.msgprint({\r\n          title: \"Checklist conclu\u00EDdo!\",\r\n          message: \"Voc\u00EA ser\u00E1 redirecionado novamente ao 'Service Protocol' para solicitar a proposta de envio.\",\r\n          indicator: 'blue'\r\n        });\r\n        form.dirty();\r\n        setTimeout(() => {\r\n          const url = `/app/service-protocol/${form.doc['sp_docname']}`;\r\n          window.open(url, '_blank');\r\n        }, 500);\r\n        await form.save();\r\n      } catch (error) {\r\n        console.error('Erro ao mover o workflow state do Service Protocol:', error);\r\n        frappe.msgprint({\r\n          title: \"Erro\",\r\n          message: \"Algo deu errado. Por favor, entre em contato com a equipe de Tecnologia da Informa\u00E7\u00E3o.\",\r\n          indicator: 'red'\r\n        });\r\n      } finally {\r\n        trigger_checklist_finished = false;\r\n      }\r\n    }\r\n  }\r\n}", "\r\nimport type { FrappeForm } from \"@anygridtech/frappe-types/client/frappe/core\";\r\n\r\n// Tipo local para CorrectionsTracker\r\ninterface CorrectionsTracker {\r\n  correction_label?: string;\r\n  correction_text?: string;\r\n  status: string;\r\n  finished_by?: string;\r\n  finished_date?: string;\r\n  name?: string;\r\n  doctype?: string;\r\n  owner?: string;\r\n  creation?: string;\r\n  modified?: string;\r\n  modified_by?: string;\r\n  workflow_state?: string;\r\n}\r\n\r\nfrappe.provide('agt.child_tracker_table');\r\n\r\n// Implementa a interface ChildTrackerTable definida nas tipagens\r\n(agt as any).child_tracker_table = {\r\n  mirror: async (frm: FrappeForm, doctypes: string[], field: string): Promise<void> => {\r\n    // Implementa\u00E7\u00E3o do mirror conforme a tipagem\r\n    for (const doctype of doctypes) {\r\n      try {\r\n        await agt.utils.form.mirror_checklist_table(frm, doctype, field, 'parent_docname', 'child_tracker_docname', 'child_tracker_workflow_state');\r\n      } catch (error) {\r\n        console.error(`Erro ao espelhar tabela para doctype ${doctype}:`, error);\r\n      }\r\n    }\r\n  },\r\n  setup: async (): Promise<void> => {\r\n    // Fun\u00E7\u00E3o principal de setup ser\u00E1 implementada abaixo\r\n    await setupChildTrackerTable();\r\n  }\r\n};\r\n\r\nconst STATUS = {\r\n  WORKFLOW: { AWAITING_ACTION: \"Aguardando A\u00E7\u00E3o\", REVIEW: \"Revis\u00E3o\" },\r\n  ROW: { PENDING: \"Pendente\", FINISHED: \"Conclu\u00EDdo\" }\r\n};\r\nconst ACTION = {\r\n  REQUEST_REVIEW: \"Solicitar Revis\u00E3o\",\r\n  APPROVE_CORRECTION: \"Aprovar Corre\u00E7\u00E3o\",\r\n  NEW_CORRECTION: \"Novo Pedido\"\r\n};\r\n\r\nfunction getPending(rows: CorrectionsTracker[]) {\r\n  return rows.filter(row => row.status === STATUS.ROW.PENDING);\r\n}\r\nfunction getCorrectionsHtml(rows: CorrectionsTracker[]) {\r\n  return getPending(rows).map(row => {\r\n    const label = row.correction_label;\r\n    const text = row.correction_text;\r\n    return `<li>\u26A0\uFE0F ${label || \"\"}${label && text ? \": \" : \"\"}${text || \"\"}</li>`;\r\n  }).join(\"\");\r\n}\r\nfunction getDialogFields(rows: CorrectionsTracker[]) {\r\n  return getPending(rows).map((row, idx) => ({\r\n    fieldname: `chk_${idx}`,\r\n    fieldtype: 'Check',\r\n    label: `${row.correction_label || `Pedido ${idx + 1}`}${row.correction_text ? ` \u2014 ${row.correction_text}` : ''}`,\r\n    default: 0\r\n  }));\r\n}\r\nasync function approveCorrections(form: FrappeForm, rows: CorrectionsTracker[], onDone?: () => void) {\r\n  const pending = getPending(rows);\r\n  if (!pending.length) {\r\n    frappe.msgprint(\"N\u00E3o existem pend\u00EAncias para aprovar.\");\r\n    return;\r\n  }\r\n  const d = new frappe.ui.Dialog({\r\n    title: \"Marcar corre\u00E7\u00F5es como conclu\u00EDdas\",\r\n    fields: getDialogFields(rows),\r\n    primary_action_label: \"Confirmar e Aprovar Corre\u00E7\u00E3o\",\r\n    secondary_action_label: \"Cancelar\"\r\n  });\r\n  d.set_primary_action(\"Confirmar e Aprovar Corre\u00E7\u00E3o\", async () => {\r\n    const values = d.get_values();\r\n    if (!Object.values(values).every(v => v === 1 || v === true)) {\r\n      frappe.msgprint({ title: \"Aten\u00E7\u00E3o\", message: `Para aprovar a corre\u00E7\u00E3o, marque todas as pend\u00EAncias como corrigidas.`, indicator: \"orange\" });\r\n      return;\r\n    }\r\n    await Promise.all(pending.map(row => agt.utils.table.row.update_one(row as any, {\r\n      status: STATUS.ROW.FINISHED,\r\n      finished_by: frappe.boot.user.email,\r\n      finished_date: frappe.datetime.now_datetime()\r\n    })));\r\n    form.dirty();\r\n    form.refresh_field('corrections_tracker');\r\n    await form.save();\r\n    d.hide();\r\n    await agt.utils.update_workflow_state({\r\n      doctype: form.doctype,\r\n      docname: form.docname,\r\n      workflow_state: STATUS.WORKFLOW.AWAITING_ACTION,\r\n      callback: async () => {\r\n        frappe.msgprint({ title: \"Corre\u00E7\u00F5es aprovadas\", message: `Todas as pend\u00EAncias foram marcadas como conclu\u00EDdas.`, indicator: \"green\" });\r\n        form.dirty();\r\n        form.refresh_field('corrections_tracker');\r\n        await form.save();\r\n        onDone && onDone();\r\n      }\r\n    });\r\n  });\r\n  d.show();\r\n}\r\n\r\nfunction loadAdminButtons() {\r\n  if (!frappe.boot.user.roles.includes(\"System Manager\")) return;\r\n  Object.values(STATUS.WORKFLOW).forEach(status => {\r\n    cur_frm.add_custom_button(`Ir para ${status}`, async () => {\r\n      await agt.utils.update_workflow_state({\r\n        doctype: cur_frm.doctype,\r\n        docname: cur_frm.docname,\r\n        workflow_state: status,\r\n        ignore_workflow_validation: true,\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nasync function setupChildTrackerTable() {\r\n  if (cur_frm.doc.__islocal || !cur_frm.fields_dict?.['corrections_tracker']) return;\r\n  const meta = await agt.utils.doc.get_doc_meta('Corrections Tracker');\r\n  if (!meta) return;\r\n  const correctionLabelFields: Record<string, any> = {};\r\n  meta.fields.forEach((field: any) => {\r\n    if (field.fieldname === 'correction_label') correctionLabelFields[field.fieldname] = field;\r\n  });\r\n  const labels = Object.values(cur_frm.fields_dict)\r\n    .filter(f => f.df.permlevel === 0 && !f.df.read_only && !f.df.hidden && !['Section Break', 'Column Break', 'Button', 'Table'].includes(f.df.fieldtype))\r\n    .map(f => (f.df.label || f.__label)?.trim()).filter(Boolean);\r\n\r\n  frappe.ui.form.on(cur_frm.doctype, 'corrections_tracker_on_form_rendered', async function () {\r\n    if (!cur_frm.cur_grid?.doc.__islocal) return;\r\n    Object.keys(correctionLabelFields).forEach(fieldName => cur_frm.cur_grid?.set_field_property(fieldName, \"options\", labels));\r\n  });\r\n\r\n  frappe.ui.form.on(cur_frm.doctype, {\r\n    async before_workflow_action(form: FrappeForm) {\r\n      const ws = form.doc.workflow_state;\r\n      const action = form.states?.frm?.selected_workflow_action;\r\n      const rows = form.doc['corrections_tracker'] || [];\r\n      if (ws === STATUS.WORKFLOW.AWAITING_ACTION && action === ACTION.REQUEST_REVIEW) {\r\n        if (!getPending(rows).length) frappe.throw(`Adicione ao menos um pedido de corre\u00E7\u00E3o (status \"Pendente\") antes de solicitar revis\u00E3o.`);\r\n        await agt.utils.update_workflow_state({\r\n          doctype: form.doctype,\r\n          docname: form.docname,\r\n          workflow_state: STATUS.WORKFLOW.REVIEW,\r\n          ignore_workflow_validation: true,\r\n          callback: async () => {\r\n            frappe.msgprint({ title: \"Enviado para Revis\u00E3o\", message: `O documento foi enviado para \"<b>${STATUS.WORKFLOW.REVIEW}</b>\".`, indicator: \"blue\" });\r\n            form.dirty();\r\n            form.refresh_field('corrections_tracker');\r\n            await form.save();\r\n          }\r\n        });\r\n        return false;\r\n      }\r\n      // Disabled because it is preventing the workflow state to be proceded\r\n      // when there are no pending corrections.\r\n      // if (ws === STATUS.WORKFLOW.REVIEW && action === ACTION.APPROVE_CORRECTION) {\r\n      //   if (!getPending(rows).length) frappe.throw(`N\u00E3o h\u00E1 pedidos pendentes para aprovar.`);\r\n      //   await approveCorrections(form, rows);\r\n      //   return false;\r\n      // }\r\n      return true;\r\n    },\r\n    async before_save(form: FrappeForm) {\r\n      const rows = form.doc['corrections_tracker'] || [];\r\n      const activeLabels = getPending(rows).map(row => row.correction_label).filter(Boolean);\r\n      if (new Set(activeLabels).size < activeLabels.length) {\r\n        frappe.throw(`<b>Falha ao salvar:</b><br>Existem 'R\u00F3tulos da Corre\u00E7\u00E3o' duplicados entre os pedidos ativos. Cada pedido deve referir um campo \u00FAnico.`);\r\n      }\r\n      getPending(rows).forEach(row => {\r\n        if (!row.correction_label || !row.correction_text) {\r\n          frappe.throw(`<b>Falha ao salvar:</b><br>Para cada pedido com status \"Pendente\" \u00E9 necess\u00E1rio preencher 'R\u00F3tulo da Corre\u00E7\u00E3o' e 'Texto da Corre\u00E7\u00E3o'.`);\r\n        }\r\n      });\r\n    },\r\n    async after_save(form: FrappeForm) {\r\n      const ws = form.doc.workflow_state;\r\n      const rows = form.doc['corrections_tracker'] || [];\r\n      const pending = getPending(rows);\r\n      if (!pending.length) return;\r\n      const html = getCorrectionsHtml(rows);\r\n      if (!html.length) return;\r\n      if (ws === STATUS.WORKFLOW.AWAITING_ACTION) {\r\n        const confirmDiag = frappe.confirm(`Existem pedidos pendentes. Deseja enviar para \"<b>${STATUS.WORKFLOW.REVIEW}</b>\" agora?<br><br><ul>${html}</ul>`, async () => {\r\n          await agt.utils.update_workflow_state({\r\n            doctype: form.doctype,\r\n            docname: form.docname,\r\n            workflow_state: STATUS.WORKFLOW.REVIEW,\r\n            ignore_workflow_validation: true,\r\n            callback: async () => {\r\n              frappe.msgprint({ title: \"Enviado para Revis\u00E3o\", message: `O documento foi enviado para \"<b>${STATUS.WORKFLOW.REVIEW}</b>\".`, indicator: \"blue\" });\r\n              form.dirty();\r\n              form.refresh_field('corrections_tracker');\r\n            }\r\n          });\r\n        });\r\n        confirmDiag.set_primary_action(\"Sim, enviar para revis\u00E3o.\");\r\n        confirmDiag.set_secondary_action_label(\"N\u00E3o, depois.\");\r\n      }\r\n      if (ws === STATUS.WORKFLOW.REVIEW) {\r\n        frappe.msgprint({ title: \"Corre\u00E7\u00F5es pendentes\", message: `Confirme se os seguintes itens foram corrigidos pelo cliente:<br><br><ul>${html}</ul>`, indicator: \"orange\" });\r\n      }\r\n    },\r\n    async refresh() { loadAdminButtons(); },\r\n    async onload(form: FrappeForm) {\r\n      loadAdminButtons();\r\n      form.set_df_property('corrections_tracker', 'cannot_delete_rows', 1);\r\n      const rows = form.doc['corrections_tracker'] || [];\r\n      if (getPending(rows).length) form.set_df_property('corrections_tracker', 'cannot_add_rows', 1);\r\n      if (form.doc.workflow_state === STATUS.WORKFLOW.REVIEW) {\r\n        form.add_custom_button('Aprovar Corre\u00E7\u00E3o', async () => approveCorrections(form, rows));\r\n        form.add_custom_button(ACTION.NEW_CORRECTION, async () => {\r\n          const confirmDiag = frappe.confirm(\"Tem certeza que deseja criar um novo pedido de corre\u00E7\u00E3o?\", async () => {\r\n            const finishedRows = (form.doc['corrections_tracker'] || []).filter((row: CorrectionsTracker) => row.status === STATUS.ROW.FINISHED);\r\n            await Promise.all(finishedRows.map((row: CorrectionsTracker) => agt.utils.table.row.update_one(row as any, {\r\n              status: STATUS.ROW.FINISHED,\r\n              finished_by: frappe.boot.user.email,\r\n              finished_date: frappe.datetime.now_datetime()\r\n            })));\r\n            setTimeout(() => {\r\n              form.set_df_property('corrections_tracker', 'cannot_add_rows', 0);\r\n              frappe.msgprint(\"Crie um novo pedido de corre\u00E7\u00E3o para o cliente com os campos faltantes.\");\r\n            }, 2000);\r\n          });\r\n          confirmDiag.set_primary_action(\"Sim, criar novo pedido.\");\r\n          confirmDiag.set_secondary_action_label(\"N\u00E3o, cancelar.\");\r\n        });\r\n      }\r\n      const html = getCorrectionsHtml(rows);\r\n      if (!getPending(rows).length || !html.length) return;\r\n      let msg = `<ul>${html}</ul><br>`;\r\n      msg += form.doc.workflow_state === STATUS.WORKFLOW.REVIEW\r\n        ? `<p>Marque cada pend\u00EAncia como corrigida no bot\u00E3o 'Aprovar Corre\u00E7\u00E3o'. S\u00F3 ser\u00E1 poss\u00EDvel aprovar se todas estiverem marcadas.</p>`\r\n        : `<p>H\u00E1 pedidos pendentes. Voc\u00EA pode enviar para revis\u00E3o clicando em '${ACTION.REQUEST_REVIEW}'.</p>`;\r\n      frappe.msgprint({ title: \"Pedidos de Corre\u00E7\u00E3o Pendentes\", message: msg, indicator: \"orange\" });\r\n    },\r\n  });\r\n}", "declare global {\n  interface Window {\n    growatt?: any;\n  }\n}\n\nfrappe.provide(\"growatt.namespace\");\n\n// Declarar o objeto growatt se n\u00E3o existir\nif (typeof window.growatt === 'undefined') {\n  (window as any).growatt = {};\n}\n\n/**\n * Ordinal mapping from workflow state keys to numeric IDs.\n *\n * - Provide a small, centralized mapping so code can compare workflow\n *   progression using simple numeric operators (>, <, >=, <=) instead of\n *   repeated string comparisons or ad-hoc ordering logic.\n * - The numeric `id` represents the ordinal (linear) position of the state.\n * - When adding a new state, insert it at the correct logical position and\n *   assign the next id. Avoid reordering existing entries unless you intend\n *   to change the global workflow ordering for all the workflow consumers.\n *\n */\n\nwindow.growatt.namespace.service_protocol = {\n  workflow_action: {\n    request_revision: {\n      name: \"Solicitar Revis\u00E3o\",\n      id: 1\n    },\n    request_checklist: {\n      name: \"Solicitar Checklist\",\n      id: 2\n    },\n    request_correction: {\n      name: \"Solicitar Proposta de Envio\",\n      id: 3\n    },\n    reject: {\n      name: \"Rejeitar\",\n      id: 4\n    },\n    cancel: {\n      name: \"Cancelar\",\n      id: 5\n    },\n    finish_correction: {\n      name: \"Aprovar Corre\u00E7\u00E3o\",\n      id: 6\n    },\n  },\n  workflow_state: {\n    holding_action: {\n      name: \"Aguardando A\u00E7\u00E3o\",\n      id: 1\n    },\n    growatt_review: {\n      name: \"Revis\u00E3o\",\n      id: 2\n    },\n    finished: {\n      name: \"Conclu\u00EDdo\",\n      id: 3\n    },\n    rejected: {\n      name: \"Rejeitado\",\n      id: 4\n    },\n    cancelled: {\n      name: \"Cancelado\",\n      id: 5\n    }\n  }\n};\n\nwindow.growatt.namespace.compliance_statement = {\n  workflow_action: {\n    approve: {\n      name: \"Aprovar\",\n      id: 1\n    },\n    request_analysis: {\n      name: \"Solicitar An\u00E1lise\",\n      id: 2\n    },\n    request_correction: {\n      name: \"Solicitar Corre\u00E7\u00E3o\",\n      id: 3\n    },\n    finish_review: {\n      name: \"Finalizar Revis\u00E3o\",\n      id: 4\n    },\n    reject: {\n      name: \"Rejeitar\",\n      id: 5\n    },\n    finish_service: {\n      name: \"Finalizar Atendimento\",\n      id: 6\n    },\n    cancel: {\n      name: \"Cancelar\",\n      id: 7\n    },\n    finish_correction: {\n      name: \"Finalizar Corre\u00E7\u00E3o\",\n      id: 8\n    },\n    request_documentation: {\n      name: \"Solicitar Documenta\u00E7\u00E3o\",\n      id: 9\n    },\n    request_checklist: {\n      name: \"Solicitar Checklist\",\n      id: 10\n    },\n    forward_to_support: {\n      name: \"Encaminhar ao Suporte\",\n      id: 11\n    },\n  },\n  workflow_state: {\n    customer_finish_filling: {\n      name: \"Cliente: Finalizar Preenchimento\",\n      id: 1\n    },\n    growatt_preliminary_assessment: {\n      name: \"An\u00E1lise Preliminar\",\n      id: 2\n    },\n    customer_fix_info: {\n      name: \"Cliente: Corrigir Informa\u00E7\u00F5es\",\n      id: 3\n    },\n    growatt_review: {\n      name: \"Revis\u00E3o\",\n      id: 4\n    },\n    customer_checklist_requested: {\n      name: \"Cliente: Checklist Solicitado\",\n      id: 5\n    },\n    checklist_finished: {\n      name: \"Checklist Conclu\u00EDdo\",\n      id: 6\n    },\n    shipping_proposal: {\n      name: \"Proposta de Envio\",\n      id: 7\n    },\n    warranty_approved: {\n      name: \"Garantia Aprovada\",\n      id: 9\n    },\n    rejected: {\n      name: \"Rejeitado\",\n      id: 10\n    },\n    finished: {\n      name: \"Conclu\u00EDdo\",\n      id: 11\n    },\n    cancelled: {\n      name: \"Cancelado\",\n      id: 12\n    },\n    approved: {\n      name: \"Aprovado\",\n      id: 13\n    },\n    finished_fixed: {\n      name: \"Finalizado: Corrigido\",\n      id: 14\n    },\n    finished_missing: {\n      name: \"Finalizado: Corre\u00E7\u00E3o Faltante\",\n      id: 15\n    },\n    customer_necessary_action: {\n      name: \"Cliente: A\u00E7\u00E3o Necess\u00E1ria\",\n      id: 16\n    },\n  }\n};\n\nwindow.growatt.namespace.checklist = {\n  workflow_state: {\n    pre_analysis: {\n      name: \"An\u00E1lise Preliminar\",\n      id: 1\n    },\n    customer_fix_info: {\n      name: \"Cliente: Corrigir Informa\u00E7\u00F5es\",\n      id: 2\n    },\n    growatt_review: {\n      name: \"Revis\u00E3o\",\n      id: 3\n    },\n    finished: {\n      name: \"Conclu\u00EDdo\",\n      id: 4\n    },\n    rejected: {\n      name: \"Rejeitado\",\n      id: 5\n    },\n    cancelled: {\n      name: \"Cancelado\",\n      id: 6\n    }\n  }\n};\n\nwindow.growatt.namespace.ticket = {\n  workflow_action: {\n    approve: {\n      name: \"Aprovar\",\n      id: 1\n    },\n    finish: {\n      name: \"Concluir\",\n      id: 2\n    },\n    reject: {\n      name: \"Rejeitar\",\n      id: 3\n    },\n    cancel: {\n      name: \"Cancelar\",\n      id: 4\n    },\n    reactive: {\n      name: \"Reativar\",\n      id: 5\n    },\n  },\n  workflow_state: {\n    draft: {\n      name: \"Rascunho\",\n      id: 1\n    },\n    active: {\n      name: \"Ativo\",\n      id: 2\n    },\n    finished: {\n      name: \"Concluido\",\n      id: 3\n    },\n    rejected: {\n      name: \"Rejeitado\",\n      id: 4\n    },\n    cancelled: {\n      name: \"Cancelado\",\n      id: 5\n    },\n  }\n};", "import type { DialogConfiguration } from \"@anygridtech/frappe-types/client/frappe/ui/Dialog\";\r\n\r\nfrappe.provide('agt.ui.enhanced_dialog');\r\nfrappe.ui.Dialog = class EnhancedDialog extends frappe.ui.Dialog {\r\n  constructor(opts: DialogConfiguration) {\r\n    super(opts);\r\n\r\n    // Reset position for each new modal\r\n    this['$wrapper'].on('show.bs.modal', () => {\r\n      const wrapperEl = this['$wrapper'][0] as HTMLElement;\r\n      wrapperEl.style.left = '';\r\n      wrapperEl.style.top = '';\r\n      // Also clear any margin offsets\r\n      wrapperEl.style.margin = '';\r\n    });\r\n\r\n    // Detect if the device is mobile\r\n    const isMobile = /Mobi|Android/i.test(navigator.userAgent);\r\n\r\n    // Always make dialog fullscreen on mobile devices\r\n    if (isMobile) {\r\n      this['$wrapper'].addClass('modal-fullscreen');\r\n      this['$wrapper'].css({\r\n        width: '100%',\r\n        height: '100%',\r\n        top: 0,\r\n        left: 0,\r\n        margin: 0,\r\n        borderRadius: 0\r\n      });\r\n      this['$wrapper'].find('.modal-content').css({\r\n        height: '100%',\r\n        borderRadius: 0\r\n      });\r\n    }\r\n\r\n    // Prevent closing with ESC or external click\r\n    this['$wrapper'].on('keydown', (e: JQuery.KeyDownEvent) => {\r\n      if (e.key === 'Escape') {\r\n        e.preventDefault();\r\n        e.stopImmediatePropagation();\r\n      }\r\n    });\r\n    this['$wrapper'].on('click', (e: JQuery.ClickEvent) => {\r\n      if ($(e.target).hasClass('modal')) {\r\n        e.preventDefault();\r\n        e.stopImmediatePropagation();\r\n      }\r\n    });\r\n    \r\n    this.makeDraggable();\r\n  }\r\n\r\n  private makeDraggable(): void {\r\n    const wrapperEl = this['$wrapper'][0] as HTMLElement;\r\n    const headerEl = this['$wrapper'].find('.modal-header')[0] as HTMLElement;\r\n    let dragging = false;\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n\r\n    // Start drag (mouse or touch)\r\n    const startDrag = (clientX: number, clientY: number) => {\r\n      dragging = true;\r\n      offsetX = clientX - wrapperEl.offsetLeft;\r\n      offsetY = clientY - wrapperEl.offsetTop;\r\n    };\r\n\r\n    // Move element\r\n    const doDrag = (clientX: number, clientY: number) => {\r\n      if (dragging) {\r\n        wrapperEl.style.left = `${clientX - offsetX}px`;\r\n        wrapperEl.style.top = `${clientY - offsetY}px`;\r\n      }\r\n    };\r\n\r\n    // Mouse events\r\n    headerEl.addEventListener('mousedown', (e: MouseEvent) => {\r\n      // Don't start dragging when clicking the close button\r\n      if ((e.target as HTMLElement).closest('.modal-header .close, .modal-header .btn-close, [data-dismiss=\"modal\"]')) {\r\n        return;\r\n      }\r\n      startDrag(e.clientX, e.clientY);\r\n    });\r\n    document.addEventListener('mousemove', (e: MouseEvent) => doDrag(e.clientX, e.clientY));\r\n    document.addEventListener('mouseup', () => { dragging = false; });\r\n\r\n    // Touch events\r\n    headerEl.addEventListener('touchstart', (e: TouchEvent) => {\r\n      // Ignore touches on close elements\r\n      const target = e.target as HTMLElement;\r\n      if (target.closest('.modal-header .close, .modal-header .btn-close, [data-dismiss=\"modal\"]')) {\r\n        return;\r\n      }\r\n      const touch = e.touches[0];\r\n      if (touch) {\r\n        startDrag(touch.clientX, touch.clientY);\r\n        doDrag(touch.clientX, touch.clientY);\r\n      }\r\n      e.preventDefault();\r\n    }, { passive: false });\r\n\r\n    document.addEventListener('touchend', () => { dragging = false; });\r\n  }\r\n};", "\r\nimport type {\r\n  UltraDialogField,\r\n  UltraDialogInstance,\r\n  UltraDialogProps,\r\n  UltraDialogSetMessageOptions,\r\n  UltraDialogState,\r\n  RemovableProps\r\n} from '@anygridtech/frappe-agt-types/agt/client/ui/ultra_dialog';\r\n\r\nfrappe.provide('agt.ui.ultra_dialog');\r\n\r\n/**\r\n * Implements a customizable, draggable modal dialog with header, body, and footer sections.\r\n * Supports dynamic theming, show/hide toggles, copy-to-clipboard, and close behavior.\r\n */\r\nclass UltraDialogImpl implements UltraDialogInstance {\r\n  // --- Private DOM references ---\r\n  private modal: HTMLElement | null = null;\r\n  private header: HTMLElement | null = null;\r\n  private body: HTMLElement | null = null;\r\n  private footer: HTMLElement | null = null;\r\n  private backdrop: HTMLElement | null = null;\r\n  private hide_btn: HTMLElement | null = null;\r\n  private copy_btn: HTMLElement | null = null;\r\n  private close_btn: HTMLButtonElement | null = null;\r\n  // --- Internal state and identifiers ---\r\n  private themeKeyCacheLocal: string = '';\r\n  private body_prefix_id: string = 'ultra-modal-body';\r\n  private header_prefix_id: string = 'ultra-modal-header';\r\n  private footer_prefix_id: string = 'ultra-modal-footer';\r\n  private close_prefix_id: string = 'ultra-modal-close';\r\n  private copy_prefix_id = 'ultra-modal-copy';\r\n  private hide_prefix_id = 'ultra-modal-hide';\r\n  private body_id: string = '';\r\n  private header_id: string = '';\r\n  private footer_id: string = '';\r\n  private hide_id: string = '';\r\n  private copy_id: string = '';\r\n  private close_id: string = '';\r\n  // UI Element Content (Buttons/Icons)\r\n  private close_btn_default = __('Fechar');\r\n  private close_btn_waiting = `<span class=\"spinner-border spinner-border-sm me-1\" role=\"status\" aria-hidden=\"true\"></span> ${__('Aguarde...')}`;\r\n  private hide_btn_default = __('Ocultar');\r\n  private hide_btn_show = __('Mostrar');\r\n  // private closeIconDefault = frappe.utils.icon('close', 'sm');\r\n  // private closeIconWaiting = `<span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span>`;\r\n  // --- Public properties ---\r\n  id!: string;\r\n  title: string;\r\n  message: string;\r\n  size: number = 360;\r\n  zOrder: number = 1050;\r\n  can_copy: boolean = true;\r\n  can_hide: boolean = true;\r\n  can_close: boolean = true;\r\n  can_drag: boolean = true;\r\n  can_drag_mobile: boolean = true;\r\n  auto_scroll: boolean = true;\r\n  backdrop_blur: boolean = true;\r\n  state: UltraDialogState = \"default\";\r\n\r\n  /**\r\n * Creates a new UltraDialog with given properties.\r\n * @param props.title - Initial title text.\r\n * @param props.message - Initial body message.\r\n */\r\n  constructor(props: UltraDialogProps) {\r\n    this.title = props.title;\r\n    this.message = props.message;\r\n    // --- Generate unique IDs and build DOM ---\r\n    this.generate_random_id();\r\n    this.default_initialization();\r\n    this.parameters_initialization(props);\r\n  }\r\n\r\n  /**\r\n   * This function initializes the properties of the Dialog.\r\n   * It will set the default values for the dialog.\r\n   * It sets the initial visibility, drag, copy, hide and close properties.\r\n   * @param props - Properties to initialize the dialog with.\r\n   */\r\n  private parameters_initialization(props: UltraDialogProps) {\r\n    this.visible(props.visible);\r\n    this.show_hide_btn(props.can_hide ?? true);\r\n    this.show_copy_btn(props.can_copy ?? true);\r\n    this.show_close_btn(props.can_close ?? true);\r\n    this.set_drag(props.can_drag ?? true);\r\n    this.set_drag_mobile(props.can_drag_mobile ?? true);\r\n    this.set_state(props.initial_state || 'default');\r\n  }\r\n\r\n  // --- Initializes the default settings ---\r\n  private default_initialization() {\r\n    this.create_modal();\r\n    this.create_header();\r\n    this.create_body();\r\n    this.create_footer();\r\n    // this.create_backdrop();\r\n    this.load_theme_changer();\r\n    this.load_dialog_dragger();\r\n\r\n    if (this.message) {\r\n      this.set_message(this.message, { auto_scroll: this.auto_scroll });\r\n    }\r\n  }\r\n\r\n  /**\r\n * Generates unique element IDs for body, header, footer, log and close button.\r\n * @returns A unique ID for the modal dialog.\r\n */\r\n  private generate_random_id() {\r\n    this.id = `${Date.now()}-${Math.floor(Math.random() * 1000)}`;\r\n    this.body_id = `${this.body_prefix_id}-${this.id}`;\r\n    this.header_id = `${this.header_prefix_id}-${this.id}`;\r\n    this.footer_id = `${this.footer_prefix_id}-${this.id}`;\r\n    this.close_id = `${this.close_prefix_id}-${this.id}`;\r\n    this.copy_id = `${this.copy_prefix_id}-${this.id}`;\r\n    this.hide_id = `${this.hide_prefix_id}-${this.id}`;\r\n  }\r\n\r\n  /**\r\n   * Creates and appends the modal container to the document, applying base styles.\r\n   */\r\n  private create_modal() {\r\n    if (this.modal) {\r\n      return this.modal;\r\n    }\r\n    this.modal = document.createElement('div');\r\n    this.modal.id = this.id;\r\n    this.modal.setAttribute('name', 'modal');\r\n    this.modal.style.position = 'fixed';\r\n    this.modal.style.top = '120px';\r\n    this.modal.style.left = '50%';\r\n    this.modal.style.transform = 'translateX(-50%)';\r\n    this.modal.style.width = `${this.size}px`;\r\n    this.modal.style.maxWidth = '90%';\r\n    this.modal.style.zIndex = `${this.zOrder}`;\r\n    this.modal.setAttribute('role', 'dialog');\r\n    this.modal.setAttribute('aria-modal', 'true'); //\r\n    this.modal.setAttribute('aria-labelledby', this.header_id);\r\n    this.modal.setAttribute('aria-describedby', this.body_id);\r\n    const rootStyles = getComputedStyle(document.documentElement);\r\n    const backgroundColor = rootStyles.getPropertyValue('--bg-color').trim() || '#fff';\r\n    const textColor = rootStyles.getPropertyValue('--text-color').trim() || '#212529';\r\n    const borderColor = rootStyles.getPropertyValue('--border-color').trim() || '#ced4da';\r\n    this.modal.style.backgroundColor = backgroundColor;\r\n    this.modal.style.color = textColor;\r\n    this.modal.style.border = `1px solid ${borderColor}`;\r\n    this.modal.style.borderRadius = '6px';\r\n    this.modal.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.2)';\r\n    this.modal.style.fontFamily = 'inherit';\r\n    this.modal.style.userSelect = 'none';\r\n    document.body.appendChild(this.modal);\r\n\r\n    return this.modal;\r\n  }\r\n\r\n  /**\r\n   * Creates the header element, applies title and drag cursor if enabled.\r\n   */\r\n  private create_header() {\r\n    if (this.header) {\r\n      console.warn(`Header already exists. You can not create another header for modal id: ${this.id}`);\r\n      return this.header;\r\n    }\r\n    this.header = document.createElement('div');\r\n    this.header.id = this.header_id;\r\n    this.header.setAttribute('name', 'header');\r\n    this.header.style.padding = '10px'; //'10px 15px'; // Adjust padding slightly\r\n    this.header.style.backgroundColor = '#f5f5f5';\r\n    this.header.style.color = '#212529';\r\n    this.header.style.borderBottom = `1px solid #ced4da`;\r\n    this.header.style.fontWeight = 'bold';\r\n    this.header.textContent = this.title;\r\n    this.header.style.cursor = this.can_drag || this.can_drag_mobile ? 'move' : 'default';\r\n    // this.header!style.filter = 'invert(1)';\r\n    this.header.style.borderRadius = '6px 6px 0 0';  // top\u2011left, top\u2011right, bottom\u2011right, bottom\u2011left :contentReference[oaicite:4]{index=4}\r\n\r\n    if (this.modal) {\r\n      this.modal.appendChild(this.header);\r\n    } else {\r\n      console.error(`Could not initialize the header. Modal is not yet defined, please instantiate the modal before trying to create the header. Modal ID: ${this.id}`);\r\n    }\r\n\r\n    return this.header;\r\n  }\r\n\r\n  /**\r\n   * Creates the body element and inserts the initial message log container.\r\n   */\r\n  private create_body() {\r\n    if (this.body) {\r\n      return this.body;\r\n    }\r\n    this.body = document.createElement('div');\r\n    this.body.id = this.body_id;\r\n    this.body.setAttribute('name', 'body');\r\n    this.body.style.padding = '10px';\r\n    this.body.style.maxHeight = '300px';\r\n    this.body.style.overflowY = 'auto';\r\n    // this.body.innerHTML = `<div id=\"${this.body_id}\">${this.message}</div>`;\r\n\r\n    if (this.modal) {\r\n      this.modal.appendChild(this.body);\r\n    } else {\r\n      console.error(`Could not initialize the body. Modal is not yet defined, please instantiate the modal before trying to create the body. Modal ID: ${this.id}`);\r\n    }\r\n\r\n    return this.body;\r\n  }\r\n\r\n  /**\r\n   * Creates the footer element, adding hide, copy and close buttons as configured.\r\n   */\r\n  private create_footer() {\r\n    if (this.footer) {\r\n      return this.footer;\r\n    }\r\n    this.footer = document.createElement('div');\r\n    this.footer.id = this.footer_id;\r\n    this.footer.setAttribute('name', 'footer');\r\n    this.footer.style.padding = '10px'; // '10px 15px'; // Adjust padding slightly\r\n    this.footer.style.display = 'flex';\r\n    this.footer.style.justifyContent = 'flex-end';\r\n    this.footer.style.gap = '10px';\r\n    this.footer.style.borderTop = `1px solid #ced4da`;\r\n    this.footer.style.borderRadius = '0 0 6px 6px';  // top\u2011left, top\u2011right, bottom\u2011right, bottom\u2011left :contentReference[oaicite:4]{index=4}\r\n\r\n    if (this.modal) {\r\n      this.modal.appendChild(this.footer);\r\n    } else {\r\n      console.error(`Could not initialize the footer. Modal is not yet defined, please instantiate the modal before trying to create the footer. Modal ID: ${this.id}`);\r\n    }\r\n\r\n    return this.footer;\r\n\r\n  }\r\n\r\n  /**\r\n   * Creates a semi-transparent backdrop element for the modal dialog.\r\n   * The backdrop covers the full viewport and sits just below the modal in z-order.\r\n   */\r\n  private create_backdrop() {\r\n    if (this.backdrop) {\r\n      return this.backdrop;\r\n    }\r\n    this.backdrop = document.createElement('div');\r\n    this.backdrop.style.position = 'fixed';\r\n    this.backdrop.style.top = '0';\r\n    this.backdrop.style.left = '0';\r\n    this.backdrop.style.width = '100vw';\r\n    this.backdrop.style.height = '100vh';\r\n    this.backdrop.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\r\n    this.backdrop.style.zIndex = `${this.zOrder - 1}`;\r\n    \r\n    if (this.backdrop_blur) {\r\n      this.backdrop.style.backdropFilter = 'blur(2px)';\r\n    }\r\n    // this.backdrop.style.opacity = '0.5';\r\n    document.body.appendChild(this.backdrop);\r\n\r\n    return this.backdrop;\r\n  }\r\n\r\n  /**\r\n  * Destroys the backdrop element if it exists.\r\n  *\r\n  * This method checks if the `backdrop` element has been created. \r\n  * If so, it removes it from the DOM and sets the reference to null, \r\n  * ensuring proper cleanup and avoiding memory leaks.\r\n  */\r\n  private destroy_backdrop() {\r\n    if (this.backdrop) {\r\n      this.backdrop.remove();\r\n      this.backdrop = null;\r\n    }\r\n  }\r\n\r\n  public set_message(\r\n    message: string,\r\n    options?: UltraDialogSetMessageOptions): this {\r\n\r\n    const bodyElement = document.getElementById(this.body_id);\r\n    if (!bodyElement) {\r\n      console.error(\r\n        `UltraDialog body element not found for ID: ${this.body_id}`\r\n      );\r\n      return this;\r\n    }\r\n\r\n    const messageElement = document.createElement('div');\r\n    messageElement.style.marginBottom = '8px';\r\n    messageElement.innerHTML = message;\r\n\r\n    bodyElement.appendChild(messageElement);\r\n\r\n    const shouldScroll = options?.auto_scroll !== undefined ? options.auto_scroll : this.auto_scroll;\r\n\r\n    if (shouldScroll) {\r\n      setTimeout(() => {\r\n        // Scroll to the bottom of the body element after a short delay\r\n        bodyElement.scrollTop = bodyElement.scrollHeight;\r\n      }, 500);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  public set_title(title: string): this {\r\n    if (!this.header) return this;\r\n    this.title = title;\r\n    this.header.textContent = title;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Creates a button to toggle the visibility of the modal body.\r\n   * The button text changes based on the current visibility state of the body.\r\n   * @returns The created hide button element.\r\n   */\r\n  private create_hide_btn() {\r\n    if (!this.footer) return;\r\n    this.hide_btn = document.createElement('button');\r\n    this.hide_btn.id = this.hide_id;\r\n    this.hide_btn.setAttribute('name', 'hide_btn');\r\n    this.hide_btn.className = 'btn btn-sm btn-secondary';\r\n    const isHidden = this.body && this.body.style.display === 'none';\r\n    this.hide_btn.textContent = isHidden ? this.hide_btn_default : this.hide_btn_show;\r\n    this.hide_btn.onclick = () => {\r\n      if (this.hide_btn === null) return;\r\n      if (!this.body) return;\r\n      if (this.body.style.display === 'none') {\r\n        this.body.style.display = '';\r\n        this.hide_btn.textContent = this.hide_btn_default;\r\n      } else {\r\n        this.body.style.display = 'none';\r\n        this.hide_btn.textContent = this.hide_btn_show;\r\n      }\r\n    };\r\n    this.footer.insertBefore(this.hide_btn, this.footer.firstChild);\r\n    return this.hide_btn;\r\n  }\r\n\r\n\r\n  public show_hide_btn(show: boolean): this {\r\n    if (!this.footer) return this;\r\n    if (!show && this.hide_btn) this.removeElementById(this.hide_id);\r\n    if (show && !this.hide_btn) this.create_hide_btn();\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Creates a button to copy the content of the modal body to the clipboard.\r\n   * @returns The created copy button element.\r\n   */\r\n  private create_copy_btn() {\r\n    if (!this.footer) return;\r\n    this.copy_btn = document.createElement('button');\r\n    this.copy_btn.id = this.copy_id;\r\n    this.copy_btn.setAttribute('name', 'copy_btn');\r\n    this.copy_btn.className = 'btn btn-sm btn-secondary';\r\n    this.copy_btn.textContent = __('Copiar');\r\n    this.copy_btn.onclick = () => {\r\n      const logContainer = this.body;\r\n      if (!logContainer || !logContainer.textContent?.trim()) {\r\n        frappe.show_alert({ message: __('Nenhuma mensagem para copiar.'), indicator: 'orange' }, 5);\r\n        return;\r\n      }\r\n      navigator.clipboard.writeText(logContainer.innerText || logContainer.textContent || '')\r\n        .then(() => frappe.show_alert({ message: __('Mensagens copiadas.'), indicator: 'green' }, 5))\r\n        .catch(err => {\r\n          console.error('Erro ao copiar:', err);\r\n          frappe.show_alert({ message: __('Falha ao copiar mensagens.'), indicator: 'red' }, 5);\r\n        });\r\n    };\r\n    if (this.hide_btn && this.hide_btn.nextSibling) this.footer.insertBefore(this.copy_btn, this.hide_btn.nextSibling);\r\n    else if (this.hide_btn) this.footer.appendChild(this.copy_btn);\r\n    else this.footer.insertBefore(this.copy_btn, this.footer.firstChild);\r\n    return this.copy_btn;\r\n  }\r\n\r\n  public show_copy_btn(show: boolean): this {\r\n    if (!this.footer) return this;\r\n    this.can_copy = show;\r\n    if (!show && this.copy_btn) this.removeElementById(this.copy_id);\r\n    if (show && !this.copy_btn) this.create_copy_btn();\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Creates a button to close the modal dialog.\r\n   * The button is only enabled when the dialog is not in the 'waiting' state.\r\n   * @returns The created close button element.\r\n   */\r\n  private create_close_btn() {\r\n    if (!this.footer) return;\r\n    this.close_btn = document.createElement('button');\r\n    this.close_btn.id = this.close_id;\r\n    this.close_btn.setAttribute('name', 'close_btn');\r\n    this.close_btn.className = 'btn btn-sm btn-primary';\r\n    this.close_btn.textContent = this.close_btn_default;\r\n    this.close_btn.onclick = () => {\r\n      if (this.state !== 'waiting') {\r\n        this.close();\r\n      }\r\n    };\r\n    this.footer.appendChild(this.close_btn);\r\n    this.update_close_btn_state();\r\n    return this.close_btn;\r\n  }\r\n\r\n  public show_close_btn(show: boolean): this {\r\n    if (!this.footer) return this;\r\n    this.can_close = show;\r\n    if (show && !this.close_btn) this.create_close_btn();\r\n    if (show && this.close_btn) this.update_close_btn_state();\r\n    if (!show && this.close_btn) this.removeElementById(this.close_id);\r\n    return this;\r\n  }\r\n\r\n  /** Helper to update close button based on state */\r\n  private update_close_btn_state() {\r\n    if (!this.close_btn) return;\r\n    if (this.state === 'waiting') {\r\n      this.close_btn.disabled = true;\r\n      this.close_btn.innerHTML = this.close_btn_waiting;\r\n    } else {\r\n      this.close_btn.disabled = false;\r\n      this.close_btn.textContent = this.close_btn_default;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Enables draggable behavior for the modal dialog.\r\n   * Allows the user to click and drag the dialog around the screen by holding the mouse on it.\r\n   * Allows the user to click/tap and drag the dialog around the screen by holding the finger on it.\r\n   * @returns The current instance of the dialog. \r\n   */\r\n  private load_dialog_dragger(): this {\r\n    // Verify if modal and header are defined\r\n    if (!this.modal || !this.header) {\r\n      console.warn(`Could not load dialog dragger. Modal or Header not defined.`);\r\n      return this;\r\n    }\r\n\r\n    // Permission to drag the modal\r\n    const canDragDesktop = !!this.can_drag;\r\n    const canDragMobile = !!this.can_drag_mobile;\r\n    // Detect if touch support is available\r\n    const isTouchDevice = 'ontouchstart' in window;\r\n\r\n    // Cursor for moving the header\r\n    this.header.style.cursor = (canDragDesktop || canDragMobile) ? 'move' : 'default';\r\n\r\n    // Dragging state\r\n    let dragging = false, offsetX = 0, offsetY = 0;\r\n\r\n    // Start dragging (desktop or mobile)\r\n    const startDrag = (clientX: number, clientY: number, allow: boolean) => {\r\n      if (!allow) return;\r\n      dragging = true;\r\n      // Calculate offset based on the current position of the  modal\r\n      offsetX = clientX - this.modal!.offsetLeft;\r\n      offsetY = clientY - this.modal!.offsetTop;\r\n    };\r\n\r\n    // Move modal\r\n    const doDrag = (clientX: number, clientY: number) => {\r\n      if (!dragging) return;\r\n      this.modal!.style.left = `${clientX - offsetX}px`;\r\n      this.modal!.style.top = `${clientY - offsetY}px`;\r\n    };\r\n\r\n    // Ends dragging\r\n    const endDrag = () => {\r\n      dragging = false;\r\n    };\r\n\r\n    // Named handlers for easier removal\r\n    const handleMouseMove = (e: MouseEvent) => doDrag(e.clientX, e.clientY);\r\n    const handleMouseUp = () => {\r\n      endDrag();\r\n      document.removeEventListener('mousemove', handleMouseMove);\r\n      document.removeEventListener('mouseup', handleMouseUp);\r\n    };\r\n\r\n    const handleTouchMove = (e: TouchEvent) => {\r\n      if (e.touches.length > 0) {\r\n        const touch = e.touches[0];\r\n        if (touch) {\r\n          doDrag(touch.clientX, touch.clientY);\r\n        }\r\n      }\r\n      e.preventDefault(); // prevents scroll\r\n    };\r\n    const handleTouchEnd = () => {\r\n      endDrag();\r\n      document.removeEventListener('touchmove', handleTouchMove);\r\n      document.removeEventListener('touchend', handleTouchEnd);\r\n    };\r\n\r\n    // --- Desktop Events ---\r\n    this.header.addEventListener('mousedown', (e: MouseEvent) => {\r\n      if (e.button !== 0) return; // only primary button\r\n      startDrag(e.clientX, e.clientY, canDragDesktop);\r\n      document.addEventListener('mousemove', handleMouseMove);\r\n      document.addEventListener('mouseup', handleMouseUp);\r\n      e.preventDefault(); // evita sele\u00E7\u00E3o de texto\r\n    });\r\n\r\n    // --- Mobile Events (if supported) ---\r\n    if (isTouchDevice) {\r\n      this.header.addEventListener('touchstart', (e: TouchEvent) => {\r\n        if (e.touches.length !== 1) return;\r\n        const touch = e.touches[0];\r\n        if (touch) {\r\n          startDrag(touch.clientX, touch.clientY, canDragMobile);\r\n        }\r\n        document.addEventListener('touchmove', handleTouchMove, { passive: false });\r\n        document.addEventListener('touchend', handleTouchEnd);\r\n        e.preventDefault();\r\n      }, { passive: false });\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public set_drag(enable: boolean) {\r\n    this.can_drag = enable;\r\n    return this;\r\n  }\r\n\r\n  public set_drag_mobile(enable: boolean) {\r\n    if (!this.can_drag) return this;\r\n    this.can_drag_mobile = enable;\r\n    return this;\r\n  }\r\n\r\n  public set_state(newState: UltraDialogState): this {\r\n    if (newState !== \"waiting\" && newState !== \"default\") {\r\n      console.warn(`Invalid state: ${newState}. State must be 'waiting' or 'default'.`);\r\n      return this;\r\n    }\r\n    console.log(`[set_state] Mudando estado de ${this.state} para: ${newState}`);\r\n    const oldState = this.state;\r\n    this.state = newState;\r\n\r\n    const backdropEl = document.getElementById(`${this.id}-backdrop`);\r\n    if (!backdropEl && (newState === 'waiting' || (this.modal && this.modal.style.display !== 'none'))) {\r\n      this.create_backdrop();\r\n    }\r\n\r\n    if (this.backdrop) {\r\n      if (newState === \"waiting\") {\r\n        this.backdrop.style.display = 'block';\r\n      } else if (oldState === \"waiting\" && newState === \"default\") {\r\n        this.backdrop.style.display = 'none';\r\n      }\r\n    }\r\n\r\n    this.update_close_btn_state();\r\n\r\n    return this;\r\n  }\r\n\r\n  public close(): this {\r\n    if (this.state === 'waiting') {\r\n      console.warn(`[UltraDialog ${this.id}] Tentativa de fechar o di\u00E1logo no estado '${this.state}'. A\u00E7\u00E3o ignorada.`);\r\n      return this;\r\n    }\r\n\r\n    if (!this.modal) return this;\r\n\r\n    this.modal.remove();\r\n    this.modal = null;\r\n    this.destroy_backdrop();\r\n\r\n    console.log(`[UltraDialog ${this.id}] Fechado e removido do DOM.`);\r\n\r\n    return this;\r\n  }\r\n\r\n  public set_z_order(z: number): this {\r\n    if (!this.modal) return this;\r\n    this.zOrder = z;\r\n    this.modal.style.zIndex = z.toString();\r\n    return this;\r\n  }\r\n\r\n  public set_size(size: number): this {\r\n    if (!this.modal) return this;\r\n    this.size = size;\r\n    this.modal.style.width = `${size}px`;\r\n    return this;\r\n  }\r\n\r\n  public visible(is_visible?: boolean): this {\r\n    const should_show = is_visible === undefined || is_visible === true;\r\n    if (should_show) {\r\n      this.show();\r\n    } else {\r\n      this.hide();\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n  * This function is used to hide the dialog.\r\n  * It will hide the dialog from the DOM.\r\n  * @returns Returns the current instance of the dialog.\r\n  */\r\n  private hide(): this {\r\n    if (this.modal) this.modal.style.display = 'none';\r\n    if (this.backdrop) this.backdrop.style.display = 'none';\r\n    return this;\r\n  }\r\n\r\n  /**\r\n  * This function is used to show the dialog.\r\n  * It will show the dialog in the DOM.\r\n  * @returns Returns the current instance of the dialog.\r\n  */\r\n  private show(): this {\r\n    // If the modal has been removed, recreate it\r\n    if (!this.modal) {\r\n      this.default_initialization();\r\n    } else {\r\n      this.modal.style.display = '';\r\n    }\r\n    if (this.backdrop) {\r\n      this.backdrop.style.display = '';\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public add_field(field: UltraDialogField): this {\r\n    if (!this.body) return this;\r\n\r\n    const fieldContainer = document.createElement('div');\r\n    fieldContainer.className = 'form-group';\r\n    fieldContainer.style.marginBottom = '1rem';\r\n\r\n    if (field.label && field.fieldtype !== 'Button') {\r\n      const label = document.createElement('label');\r\n      label.innerHTML = field.label;\r\n      if (field.reqd) {\r\n        label.innerHTML += ' <span class=\"text-danger\">*</span>';\r\n      }\r\n      fieldContainer.appendChild(label);\r\n    }\r\n\r\n    let input: HTMLElement;\r\n\r\n    switch (field.fieldtype) {\r\n      case 'Text':\r\n      case 'Small Text':\r\n      case 'Long Text':\r\n        input = document.createElement('textarea');\r\n        (input as HTMLTextAreaElement).value = field.default || '';\r\n        input.className = 'form-control';\r\n        break;\r\n\r\n      case 'Select':\r\n        input = document.createElement('select');\r\n        input.className = 'form-control';\r\n        if (Array.isArray(field.options)) {\r\n          field.options.forEach(option => {\r\n            const opt = document.createElement('option');\r\n            opt.value = option;\r\n            opt.text = option;\r\n            (input as HTMLSelectElement).add(opt);\r\n          });\r\n        }\r\n        if (field.default) {\r\n          (input as HTMLSelectElement).value = field.default;\r\n        }\r\n        break;\r\n\r\n      case 'Check':\r\n        input = document.createElement('input');\r\n        (input as HTMLInputElement).type = 'checkbox';\r\n        input.className = 'form-check-input';\r\n        if (field.default) {\r\n          (input as HTMLInputElement).checked = field.default;\r\n        }\r\n        break;\r\n\r\n      case 'Button':\r\n        input = document.createElement('button');\r\n        input.className = 'btn btn-primary btn-sm';\r\n        input.textContent = field.label;\r\n        if (field.click) {\r\n          input.onclick = field.click;\r\n        }\r\n        break;\r\n\r\n      case 'Date':\r\n        input = document.createElement('input');\r\n        (input as HTMLInputElement).type = 'date';\r\n        input.className = 'form-control';\r\n        if (field.default) {\r\n          (input as HTMLInputElement).value = field.default;\r\n        }\r\n        break;\r\n\r\n      case 'Time':\r\n        input = document.createElement('input');\r\n        (input as HTMLInputElement).type = 'time';\r\n        input.className = 'form-control';\r\n        if (field.default) {\r\n          (input as HTMLInputElement).value = field.default;\r\n        }\r\n        break;\r\n\r\n      case 'Int':\r\n      case 'Float':\r\n        input = document.createElement('input');\r\n        (input as HTMLInputElement).type = 'number';\r\n        input.className = 'form-control';\r\n        if (field.fieldtype === 'Float') {\r\n          (input as HTMLInputElement).step = '0.01';\r\n        }\r\n        if (field.default) {\r\n          (input as HTMLInputElement).value = field.default;\r\n        }\r\n        break;\r\n\r\n      case 'Color':\r\n        input = document.createElement('input');\r\n        (input as HTMLInputElement).type = 'color';\r\n        input.className = 'form-control';\r\n        if (field.default) {\r\n          (input as HTMLInputElement).value = field.default;\r\n        }\r\n        break;\r\n\r\n      case 'Rating':\r\n        input = document.createElement('input');\r\n        (input as HTMLInputElement).type = 'range';\r\n        input.className = 'form-range';\r\n        (input as HTMLInputElement).min = '0';\r\n        (input as HTMLInputElement).max = '5';\r\n        if (field.default) {\r\n          (input as HTMLInputElement).value = field.default;\r\n        }\r\n        break;\r\n\r\n      default:\r\n        input = document.createElement('input');\r\n        (input as HTMLInputElement).type = 'text';\r\n        input.className = 'form-control';\r\n        if (field.default) {\r\n          (input as HTMLInputElement).value = field.default;\r\n        }\r\n    }\r\n\r\n    input.id = `field-${field.fieldname}`;\r\n    if (field.placeholder) {\r\n      (input as HTMLInputElement).placeholder = field.placeholder;\r\n    }\r\n    if (field.onchange) {\r\n      input.onchange = field.onchange;\r\n    }\r\n    if (field.read_only) {\r\n      (input as HTMLInputElement).readOnly = true;\r\n    }\r\n    if (field.depends_on) {\r\n      input.setAttribute('data-depends-on', field.depends_on);\r\n    }\r\n\r\n    if (field.description) {\r\n      const description = document.createElement('small');\r\n      description.className = 'form-text text-muted';\r\n      description.textContent = field.description;\r\n      fieldContainer.appendChild(description);\r\n    }\r\n\r\n    fieldContainer.appendChild(input);\r\n    this.body?.appendChild(fieldContainer);\r\n\r\n    return this;\r\n  }\r\n\r\n  public removeElementByProperty(propName: RemovableProps): this {\r\n    const el = (this as any)[propName] as HTMLElement | null;\r\n    if (el && this.modal && this.modal.contains(el)) {\r\n      el.remove();\r\n      (this as any)[propName] = null;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public removeElementById(elementId: string): this {\r\n    if (!this.modal) return this;\r\n    const el = this.modal.querySelector<HTMLElement>(`#${elementId}`);\r\n    if (el) el.remove();\r\n    return this;\r\n  }\r\n\r\n  public removeElementsByName(name: string): this {\r\n    if (!this.modal) return this;\r\n    const els = this.modal.querySelectorAll<HTMLElement>(`[name=\"${name}\"]`);\r\n    els.forEach(el => el.remove());\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Sets up a MutationObserver to monitor changes in theme-related CSS variables.\r\n   * Automatically updates modal styles (background, text, border, header, footer) when the theme changes.\r\n   */\r\n  load_theme_changer() {\r\n    const observer = new MutationObserver(() => {\r\n      const updated = getComputedStyle(document.documentElement);\r\n\r\n      // Retrieves the values of the relevant CSS variables\r\n      const bgColor = updated.getPropertyValue('--bg-color').trim();\r\n      const textColor = updated.getPropertyValue('--text-color').trim();\r\n      const headingBg = updated.getPropertyValue('--heading-bg').trim();\r\n      const borderColor = updated.getPropertyValue('--border-color').trim(); // Main border color\r\n\r\n      // *** Potential Adaptation: ***\r\n      // If the header/footer use DIFFERENT border colors, define specific\r\n      // CSS variables and retrieve them here:\r\n      // const headerBorderColor = updated.getPropertyValue('--header-border-color').trim() || borderColor;\r\n      // const footerBorderColor = updated.getPropertyValue('--footer-border-color').trim() || borderColor;\r\n      // And use these variables below instead of 'borderColor' for the header/footer.\r\n\r\n      const currentThemeKey = [\r\n        bgColor,\r\n        textColor,\r\n        headingBg,\r\n        borderColor,\r\n        // If using specific colors, add them to the key as well:\r\n        // headerBorderColor,\r\n        // footerBorderColor,\r\n      ].join('|');\r\n\r\n      if (!this.modal) {\r\n        console.warn(\"Theme changer: this.modal is not defined.\"); // Keep original string literal as requested\r\n        return;\r\n      }\r\n\r\n      if (currentThemeKey !== this.themeKeyCacheLocal) {\r\n        console.log(\"Theme changed, updating modal, header, and footer styles...\"); // Keep original string literal as requested\r\n        this.themeKeyCacheLocal = currentThemeKey;\r\n\r\n        // --- Main Modal Styles ---\r\n        if (bgColor) {\r\n          this.modal.style.backgroundColor = bgColor;\r\n        }\r\n        if (textColor) {\r\n          this.modal.style.color = textColor;\r\n        }\r\n        if (borderColor) {\r\n          this.modal.style.border = `1px solid ${borderColor}`;\r\n        } else {\r\n          this.modal.style.border = 'none';\r\n        }\r\n\r\n        // --- Header Styles ---\r\n        if (this.header) {\r\n          // Background and Text Color\r\n          this.header.style.backgroundColor = headingBg || bgColor; // Fallback to main bg\r\n          if (textColor) {\r\n            this.header.style.color = textColor;\r\n          }\r\n\r\n          // Header Bottom Border (Assuming this is the line you want)\r\n          if (borderColor) {\r\n            // Use 'borderColor' or 'headerBorderColor' if you defined a specific one\r\n            this.header.style.borderBottom = `1px solid ${borderColor}`;\r\n          } else {\r\n            // Remove the border if the variable doesn't exist\r\n            this.header.style.borderBottom = 'none';\r\n          }\r\n          // If you need other borders (top, left, right), add them here.\r\n          // Ex: this.header.style.borderTop = ...\r\n        }\r\n\r\n        // --- Footer Styles ---\r\n        if (this.footer) { // Adds the check and logic for the footer\r\n          // Background and Text Color (Optional, but consistent)\r\n          // Can use specific colors if necessary (e.g., --footer-bg-color)\r\n          if (bgColor) {\r\n            this.footer.style.backgroundColor = bgColor; // Or headingBg? Or a specific color?\r\n          }\r\n          if (textColor) {\r\n            this.footer.style.color = textColor;\r\n          }\r\n\r\n          // Footer Top Border (Assuming this is the line you want)\r\n          if (borderColor) {\r\n            // Use 'borderColor' or 'footerBorderColor' if you defined a specific one\r\n            this.footer.style.borderTop = `1px solid ${borderColor}`;\r\n          } else {\r\n            // Remove the border if the variable doesn't exist\r\n            this.footer.style.borderTop = 'none';\r\n          }\r\n          // If you need other borders (bottom, left, right), add them here.\r\n          // Ex: this.footer.style.borderBottom = ...\r\n        }\r\n\r\n        // --- Margin Styles (if necessary) ---\r\n        // const marginValue = updated.getPropertyValue('--modal-margin').trim();\r\n        // if (this.modal && marginValue) {\r\n        //    this.modal.style.margin = marginValue;\r\n        // }\r\n      }\r\n    });\r\n\r\n    observer.observe(document.documentElement, {\r\n      attributes: true,\r\n      attributeFilter: ['class', 'style'], // Observe changes to class and style attributes\r\n      subtree: true, // Observe changes in descendants as well\r\n    });\r\n\r\n    // this.themeObserver = observer; // To disconnect later, if needed\r\n  }\r\n}\r\n\r\n// Assign the class to the namespace\r\nagt.ui.UltraDialog = UltraDialogImpl;\r\n\r\n// Export for module usage (optional)\r\nexport { UltraDialogImpl as UltraDialog };", "import type { FrappeForm } from \"@anygridtech/frappe-types/client/frappe/core\";\n\nfrappe.provide('agt.utils.brazil.cnpj');\n\nagt.utils.brazil.cnpj.regex = /^(?!00\\.000\\.000\\/0000\\-00)(\\d{2}\\.\\d{3}\\.\\d{3}\\/\\d{4}\\-\\d{2})$/;\n\nagt.utils.brazil.cnpj.validate = function (frm: FrappeForm, cnpj_field: string): void {\n  let cnpj = frm.doc[cnpj_field] || '';\n  cnpj = cnpj.replace(/\\D/g, '');\n\n  if (cnpj.length !== 14) {\n    frappe.msgprint(__('CNPJ must have 14 digits.'));\n    frm.set_value(cnpj_field, '');\n    return;\n  }\n\n  // Eliminate known invalid CNPJs\n  if (agt.utils.brazil.cnpj.regex.test(cnpj)) {\n    frappe.msgprint(__('Invalid CNPJ number.'));\n    frm.set_value(cnpj_field, '');\n    return;\n  }\n\n  // Validate verification digits\n  let length = cnpj.length - 2;\n  let numbers = cnpj.substring(0, length);\n  let digits = cnpj.substring(length);\n  let sum = 0;\n  let pos = length - 7;\n\n  for (let i = length; i >= 1; i--) {\n    sum += parseInt(numbers.charAt(length - i)) * pos--;\n    if (pos < 2) pos = 9;\n  }\n\n  let result = sum % 11 < 2 ? 0 : 11 - (sum % 11);\n  if (result !== parseInt(digits.charAt(0))) {\n    frappe.msgprint(__('Invalid CNPJ number.'));\n    frm.set_value(cnpj_field, '');\n    return;\n  }\n\n  length += 1;\n  numbers = cnpj.substring(0, length);\n  sum = 0;\n  pos = length - 7;\n\n  for (let i = length; i >= 1; i--) {\n    sum += parseInt(numbers.charAt(length - i)) * pos--;\n    if (pos < 2) pos = 9;\n  }\n\n  result = sum % 11 < 2 ? 0 : 11 - (sum % 11);\n  if (result !== parseInt(digits.charAt(1))) {\n    frappe.msgprint(__('Invalid CNPJ number.'));\n    frm.set_value(cnpj_field, '');\n    return;\n  }\n\n  // If valid, format the CNPJ\n  agt.utils.brazil.cnpj.format(frm, cnpj_field);\n}\n\nagt.utils.brazil.cnpj.format = function (frm: FrappeForm, cnpj_field: string): void {\n  let cnpj = frm.doc[cnpj_field] || '';\n  cnpj = cnpj.replace(/\\D/g, '');\n\n  if (cnpj.length === 14) {\n    frm.set_value(cnpj_field, cnpj.replace(/(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2})/, '$1.$2.$3/$4-$5'));\n  }\n}\n\nagt.utils.brazil.cnpj.validate_existence = async function (frm: FrappeForm, cnpj_field: string): Promise<void> {\n  const cnpj = frm.doc[cnpj_field]?.replace(/\\D/g, '') || '';\n  \n  if (cnpj.length !== 14) {\n    frappe.msgprint(__('CNPJ must have 14 digits to check existence.'));\n    return;\n  }\n\n  try {\n    const response = await frappe.call({\n      method: 'check_cnpj_existence',\n      args: { cnpj }\n    });\n    \n    if (response.message && response.message.exists) {\n      frappe.msgprint(__('CNPJ exists and is valid.'));\n    } else {\n      frappe.msgprint(__('CNPJ not found in official records.'));\n    }\n  } catch (err) {\n    console.error('Error checking CNPJ existence:', err);\n    frappe.msgprint(__('Error checking CNPJ existence. Please try again.'));\n  }\n};", "import type { FrappeForm } from \"@anygridtech/frappe-types/client/frappe/core\";\n\nfrappe.provide('agt.utils.brazil.cpf');\n\nagt.utils.brazil.cpf.regex = /^(?!000\\.000\\.000\\-00)(\\d{3}\\.\\d{3}\\.\\d{3}\\-\\d{2})$/;\n\nagt.utils.brazil.cpf.validate = function(frm: FrappeForm, cpf_field: string): void {\n  let cpf = frm.doc[cpf_field] || '';\n  cpf = cpf.replace(/\\D/g, '');\n\n  if (cpf.length !== 11) {\n    frappe.msgprint(__('CPF must have 11 digits.'));\n    frm.set_value(cpf_field, '');\n    return;\n  }\n  \n  // Eliminate known invalid CPFs\n  if (agt.utils.brazil.cpf.regex.test(cpf)) {\n    frappe.msgprint(__('Invalid CPF number.'));\n    frm.set_value(cpf_field, '');\n    return;\n  }\n\n  // Validate verification digits\n  let sum = 0;\n  let remainder;\n\n  for (let i = 1; i <= 9; i++) {\n    sum += parseInt(cpf.substring(i - 1, i)) * (11 - i);\n  }\n\n  remainder = (sum * 10) % 11;\n  if (remainder === 10 || remainder === 11) remainder = 0;\n  if (remainder !== parseInt(cpf.substring(9, 10))) {\n    frappe.msgprint(__('Invalid CPF number.'));\n    frm.set_value(cpf_field, '');\n    return;\n  }\n\n  sum = 0;\n  for (let i = 1; i <= 10; i++) {\n    sum += parseInt(cpf.substring(i - 1, i)) * (12 - i);\n  }\n\n  remainder = (sum * 10) % 11;\n  if (remainder === 10 || remainder === 11) remainder = 0;\n  if (remainder !== parseInt(cpf.substring(10, 11))) {\n    frappe.msgprint(__('Invalid CPF number.'));\n    frm.set_value(cpf_field, '');\n    return;\n  }\n\n  // If valid, format the CPF!\n  agt.utils.brazil.cpf.format(frm, cpf_field);\n}\n\nagt.utils.brazil.cpf.format = function(frm: FrappeForm, cpf_field: string): void {\n  let cpf = frm.doc[cpf_field] || '';\n  cpf = cpf.replace(/\\D/g, '');\n\n  if (cpf.length === 11) {\n    frm.set_value(cpf_field, cpf.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4'));\n  }\n}", "import type { FrappeForm } from \"@anygridtech/frappe-types/client/frappe/core\";\n\nfrappe.provide('agt.utils.brazil');\n\nagt.utils.brazil.validate_cnpj_or_cpf = function(frm: FrappeForm, field: string, documentType: 'cpf' | 'cnpj'): void {\n  if (documentType === 'cpf') {\n    agt.utils.brazil.cpf.validate(frm, field);\n  } else if (documentType === 'cnpj') {\n    agt.utils.brazil.cnpj.validate(frm, field);\n  } else {\n    // Auto-detect based on length\n    let value = frm.doc[field] || '';\n    value = value.replace(/\\D/g, '');\n\n    if (value.length === 11) {\n      agt.utils.brazil.cpf.validate(frm, field);\n    } else if (value.length === 14) {\n      agt.utils.brazil.cnpj.validate(frm, field);\n    }\n  }\n};\n\nagt.utils.brazil.format_cnpj_or_cpf = function(frm: FrappeForm, field: string, documentType: 'cpf' | 'cnpj'): void {\n  if (documentType === 'cpf') {\n    agt.utils.brazil.cpf.format(frm, field);\n  } else if (documentType === 'cnpj') {\n    agt.utils.brazil.cnpj.format(frm, field);\n  } else {\n    // Auto-detect based on length\n    let value = frm.doc[field] || '';\n    value = value.replace(/\\D/g, '');\n\n    if (value.length === 11) {\n      agt.utils.brazil.cpf.format(frm, field);\n    } else if (value.length === 14) {\n      agt.utils.brazil.cnpj.format(frm, field);\n    }\n  }\n};", "import type { FrappeForm } from \"@anygridtech/frappe-types/client/frappe/core\";\n\n// CEP functions\nagt.utils.brazil.cep.regex = /^\\d{5}-?\\d{3}$/;\n\nagt.utils.brazil.cep.format = function (frm: FrappeForm, cep_field: string): string {\n  let cep = frm.doc[cep_field] || '';\n  cep = cep.replace(/\\D/g, '');\n\n  if (cep.length === 8) {\n    const formatted = `${cep.slice(0, 5)}-${cep.slice(5)}`;\n    frm.set_value(cep_field, formatted);\n    return formatted;\n  }\n  return cep;\n};\n\nagt.utils.brazil.cep.validate = async function (\n  frm: FrappeForm,\n  field: string,\n  addr: string,\n  neigh: string,\n  town: string,\n  state: string\n): Promise<void> {\n  const f = frm.fields_dict[field];\n  if (!f?.$input) return;\n  const $input = f.$input as JQuery<HTMLInputElement>;\n\n  /**\n   * Sets visual style icon based on validation status\n   */\n  const setVisualStyle = (status: 'warning' | 'error' | 'success' | 'default') => {\n    switch (status) {\n      case 'warning':\n        return `<i class=\"fa fa-exclamation-circle\" style=\"color:#f1c40f\"></i> `;\n      case 'error':\n        return `<i class=\"fa fa-times-circle\" style=\"color:#e74c3c\"></i> `;\n      case 'success':\n        return `<i class=\"fa fa-check-circle\" style=\"color:#27ae60\"></i> `;\n      default:\n        return '';\n    }\n  };\n\n  /**\n   * Updates UI with validation feedback\n   */\n  const updateUI = (color: string, message: string): void => {\n    let status: 'warning' | 'error' | 'success' | 'default' = 'default';\n    if (color === '#f1c40f') status = 'warning';\n    else if (color === 'red' || color === '#e74c3c') status = 'error';\n    else if (color === 'green' || color === '#27ae60') status = 'success';\n\n    const icon = setVisualStyle(status);\n    f['set_description'](\n      icon + (message ? `<b style=\"color:${color}\">${message}</b>` : '')\n    );\n  };\n\n  /**\n   * Fetches CEP data from server\n   */\n  const fetchCepData = async (cep: string) => {\n    try {\n      const response = await frappe.call({\n        method: 'check_cep',\n        args: { cep }\n      });\n      return response.message;\n    } catch (err) {\n      console.error('Erro ao consultar o CEP via server script:', err);\n      return null;\n    }\n  };\n\n  /**\n   * Validates CEP value and updates UI accordingly\n   */\n  const validateAndStyle = async (value: string): Promise<void> => {\n    const digits = value.replace(/\\D/g, '');\n\n    if (!digits) {\n      updateUI('', '');\n      return;\n    }\n\n    if (digits.length < 8) {\n      updateUI('#f1c40f', 'CEP incompleto');\n      return;\n    }\n\n    // When it has 8 digits -> query\n    const data = await fetchCepData(digits);\n    if (!data || data.message === 'CEP n\u00E3o encontrado') {\n      updateUI('red', 'CEP n\u00E3o encontrado');\n      return;\n    }\n\n    // Valid CEP \u2192 fill fields\n    frm.set_value(addr, data.street || '');\n    frm.set_value(neigh, data.neighborhood || '');\n    frm.set_value(town, data.city || '');\n    frm.set_value(state, data.state || '');\n\n    updateUI('green', 'CEP v\u00E1lido');\n  };\n\n  /**\n   * Formats CEP input and validates in real-time\n   */\n  const formatOnInput = async (e: Event): Promise<void> => {\n    const input = e.target as HTMLInputElement;\n    const originalValue = input.value;\n    const cursorBefore = input.selectionStart || 0;\n    const digitsBeforeCursor = originalValue.slice(0, cursorBefore).replace(/\\D/g, '').length;\n\n    // Only numbers\n    let digits = originalValue.replace(/\\D/g, '').slice(0, 8);\n\n    // Detect if it's an addition (typing) or removal\n    const currentFieldValue = frm.doc[field as keyof typeof frm.doc]?.toString() || '';\n    const isAdding = digits.length > currentFieldValue.replace(/\\D/g, '').length;\n\n    let formatted = digits;\n    if (isAdding && digits.length > 5) {\n      formatted = `${digits.slice(0, 5)}-${digits.slice(5)}`;\n    } else if (!isAdding) {\n      // If deleting, don't force hyphen\n      if (digits.length > 5 && originalValue.includes('-')) {\n        formatted = `${digits.slice(0, 5)}-${digits.slice(5)}`;\n      } else {\n        formatted = digits;\n      }\n    }\n\n    if (formatted !== originalValue) {\n      input.value = formatted;\n      frm.doc[field as keyof typeof frm.doc] = formatted;\n\n      // Adjust cursor\n      let newCursor = 0;\n      let countDigits = 0;\n      for (const ch of formatted) {\n        newCursor++;\n        if (/\\d/.test(ch)) countDigits++;\n        if (countDigits >= digitsBeforeCursor) break;\n      }\n      while (newCursor < formatted.length && formatted[newCursor] && /\\D/.test(formatted[newCursor] || '')) {\n        newCursor++;\n      }\n      input.setSelectionRange(newCursor, newCursor);\n    }\n\n    // Dynamic validation\n    await validateAndStyle(formatted);\n  };\n\n  // Remove previous events and add new ones\n  $input.off('.zipcode').on('input.zipcode', formatOnInput);\n\n  // If it already has a value when loading\n  const currentValue = frm.doc[field as keyof typeof frm.doc]?.toString();\n  if (currentValue) {\n    $input.trigger('input.zipcode');\n  }\n};\n\n\n\n", "import type { FrappeForm } from \"@anygridtech/frappe-types/client/frappe/core\";\n\nfrappe.provide('agt.utils.brazil');\nfrappe.provide('agt.utils.brazil.phone');\n\n// Phone functions\nagt.utils.brazil.phone.regex = /^\\(\\d{2}\\)\\s\\d{4,5}\\-\\d{4}$/;\n\nagt.utils.brazil.phone.format = function (frm: FrappeForm, phone_field: string): void {\n  let phone = frm.doc[phone_field] || '';\n  const digits = phone.replace(/\\D/g, '').slice(0, 11);\n\n  if (digits.length <= 2) {\n    frm.set_value(phone_field, digits);\n    return;\n  }\n  if (digits.length <= 6) {\n    frm.set_value(phone_field, `(${digits.substring(0, 2)}) ${digits.substring(2)}`);\n    return;\n  }\n  if (digits.length <= 10) {\n    frm.set_value(phone_field, `(${digits.substring(0, 2)}) ${digits.substring(2, 6)}-${digits.substring(6)}`);\n    return;\n  }\n  frm.set_value(phone_field, `(${digits.substring(0, 2)}) ${digits.substring(2, 7)}-${digits.substring(7)}`);\n};\n\nagt.utils.brazil.phone.validate = function (frm: FrappeForm, phoneField: string): Promise<void> {\n  return new Promise<void>(resolve => {\n    const field = frm.fields_dict[phoneField];\n    if (!field?.$input) {\n      console.error(`validate_phone: O campo '${phoneField}' n\u00E3o foi encontrado ou n\u00E3o \u00E9 um campo de entrada v\u00E1lido.`);\n      return resolve();\n    }\n\n    const $input = field.$input as JQuery<HTMLInputElement>;\n\n    /**\n     * Sets visual style icon based on validation status\n     */\n    const setVisualStyle = (status: 'default' | 'warning' | 'error' | 'success') => {\n      let icon = '';\n      switch (status) {\n        case 'warning':\n          icon = '<i class=\"fa fa-exclamation-circle\" style=\"color:#f1c40f\"></i> ';\n          break;\n        case 'error':\n          icon = '<i class=\"fa fa-times-circle\" style=\"color:#e74c3c\"></i> ';\n          break;\n        case 'success':\n          icon = '<i class=\"fa fa-check-circle\" style=\"color:#27ae60\"></i> ';\n          break;\n        default:\n          icon = '';\n      }\n      return icon;\n    };\n\n    /**\n     * Updates UI with validation feedback\n     */\n    const updateUI = (color: string, message: string): void => {\n      let status: 'default' | 'warning' | 'error' | 'success' = 'default';\n      if (color === '#f1c40f') status = 'warning';\n      else if (color === 'red' || color === '#e74c3c') status = 'error';\n      else if (color === 'green' || color === '#27ae60') status = 'success';\n      const icon = setVisualStyle(status);\n      field['set_description'](icon + (message ? `<b style='color:${color}'>${message}</b>` : ''));\n    };\n\n    /**\n     * Validates Brazilian phone number format\n     */\n    const validatePhoneFormat = (phoneNumber: string): { isValid: boolean; type: 'fixo' | 'celular' | 'invalido' } => {\n      // Remover todos os caracteres n\u00E3o num\u00E9ricos\n      const digits = phoneNumber.replace(/\\D/g, '');\n\n      // Verificar se tem entre 10 ou 11 d\u00EDgitos (com DDD)\n      const hasValidLength = digits.length === 10 || digits.length === 11;\n      if (!hasValidLength) {\n        return { isValid: false, type: 'invalido' };\n      }\n\n      const invalidDDDs = [\n        0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,\n        20, 23, 25, 26, 29, 30,\n        36, 39, 40,\n        50, 52, 56, 57, 58, 59, 60,\n        70, 72, 76, 78, 80, 90\n      ];\n\n      // Extrair DDD\n      const ddd = parseInt(digits.substring(0, 2));\n\n      // Verificar se o DDD N\u00C3O est\u00E1 na lista de DDDs inv\u00E1lidos e est\u00E1 entre 11 e 99\n      const hasValidDDD = !invalidDDDs.includes(ddd) && ddd >= 11 && ddd <= 99;\n      if (!hasValidDDD) {\n        return { isValid: false, type: 'invalido' };\n      }\n\n      // Determinar se \u00E9 celular ou fixo\n      // Celular: 11 d\u00EDgitos e come\u00E7a com 9 ap\u00F3s o DDD\n      // Fixo: 10 d\u00EDgitos e o primeiro d\u00EDgito ap\u00F3s o DDD est\u00E1 entre 2-8\n      const firstDigitAfterDDD = parseInt(digits.substring(2, 3));\n\n      if (digits.length === 11 && firstDigitAfterDDD === 9) {\n        return { isValid: true, type: 'celular' };\n      } else if (digits.length === 10 && firstDigitAfterDDD >= 2 && firstDigitAfterDDD <= 8) {\n        return { isValid: true, type: 'fixo' };\n      } else {\n        return { isValid: false, type: 'invalido' };\n      }\n    };\n\n    /**\n     * Formats phone number to Brazilian standard\n     */\n    const formatPhoneNumber = (value: string): string => {\n      // Extrair apenas os d\u00EDgitos e limitar a 11 caracteres\n      const digits = value.replace(/\\D/g, '').slice(0, 11);\n\n      // Aplicar formata\u00E7\u00E3o no padr\u00E3o brasileiro\n      if (digits.length <= 2) return digits;\n      if (digits.length <= 6) return `(${digits.substring(0, 2)}) ${digits.substring(2)}`;\n      if (digits.length <= 10) return `(${digits.substring(0, 2)}) ${digits.substring(2, 6)}-${digits.substring(6)}`;\n      return `(${digits.substring(0, 2)}) ${digits.substring(2, 7)}-${digits.substring(7)}`;\n    };\n\n    /**\n     * Handles input formatting and validation in real-time\n     */\n    const formatOnInput = (e: Event): void => {\n      const input = e.target as HTMLInputElement;\n      const originalValue = input.value;\n\n      // Armazenar posi\u00E7\u00E3o do cursor antes da formata\u00E7\u00E3o\n      const originalPos = input.selectionStart || 0;\n      const digitsBeforeCursor = (originalValue.slice(0, originalPos).replace(/\\D/g, '')).length;\n\n      // Extrair apenas d\u00EDgitos do valor original\n      const digits = originalValue.replace(/\\D/g, '');\n\n      // Aplicar formata\u00E7\u00E3o\n      const formattedValue = formatPhoneNumber(digits);\n\n      // Atualizar o campo com o valor formatado\n      if (originalValue !== formattedValue) {\n        input.value = formattedValue;\n        frm.doc[phoneField] = formattedValue;\n\n        // Ajustar posi\u00E7\u00E3o do cursor\n        let newCursorPos = 0;\n        let digitsCounted = 0;\n        for (const char of formattedValue) {\n          newCursorPos++;\n          if (/\\d/.test(char)) digitsCounted++;\n          if (digitsCounted >= digitsBeforeCursor) break;\n        }\n        while (newCursorPos < formattedValue.length && formattedValue[newCursorPos] && /\\D/.test(formattedValue[newCursorPos] || '')) {\n          newCursorPos++;\n        }\n        input.setSelectionRange(newCursorPos, newCursorPos);\n      }\n\n      // Validar e atualizar estilo\n      const validation = validatePhoneFormat(formattedValue);\n\n      if (!digits) {\n        updateUI('', ''); // Limpar UI se n\u00E3o houver d\u00EDgitos\n      } else if (digits.length < 10) {\n        updateUI('#f1c40f', 'N\u00FAmero de telefone incompleto');\n      } else if (!validation.isValid) {\n        updateUI('red', 'DDD ou n\u00FAmero de telefone inv\u00E1lido');\n      } else if (validation.type === 'celular') {\n        updateUI('green', 'Celular v\u00E1lido');\n      } else if (validation.type === 'fixo') {\n        updateUI('green', 'Telefone fixo v\u00E1lido');\n      }\n    };\n\n    // Remove eventos anteriores e adiciona novos\n    $input.off('.phone').on('input.phone', formatOnInput);\n\n    // Executar valida\u00E7\u00E3o inicial se j\u00E1 houver valor\n    const currentValue = frm.doc[phoneField]?.toString();\n    if (currentValue) {\n      $input.trigger('input.phone');\n    }\n\n    // Resolve a Promise uma vez que a configura\u00E7\u00E3o inicial esteja conclu\u00EDda\n    resolve();\n  });\n};", "frappe.provide('agt.utils.text');\n\nagt.utils.text.normalize = function(text: string): string {\n  return (text || '')\n    .toLowerCase()\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '') // remove acentos\n    .replace(/[-_\\s]/g, '') // remove h\u00EDfens, underlines e espa\u00E7os\n    .replace(/[^a-z0-9]/g, ''); // remove outros caracteres especiais\n};\n\nagt.utils.text.is_valid = function(v: any) {\n  return v !== null && v !== undefined && (typeof v === 'string' ? v.trim() !== '' : true);\n};\n\nagt.utils.text.to_snake_case = function(str: string) {\n  // Replace spaces with underscores\n  str = str.replace(/\\s+/g, '_');\n  // Convert PascalCase/CamelCase to snake_case\n  str = str.replace(/([a-z])([A-Z])/g, '$1_$2');\n  return str.toLowerCase();\n};\n\nagt.utils.text.to_pascal_case_spaced = function(str: string) {\n  return str\n    .replace(/([a-z])([A-Z])/g, '$1 $2') // Insert space before uppercase letters in camelCase\n    .replace(/[^a-zA-Z0-9 ]/g, ' ') // Replace non-alphanumeric characters with spaces\n    .split(/\\s+/) // Split by spaces\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()) // Capitalize each word\n    .join(' '); // Join with spaces\n};", "frappe.provide('agt.utils');\n\nagt.utils.workflow_transition = async function(\n  form: any,\n  action: string,\n  callback?: ((f: any) => void) | ((f: any) => Promise<void>)\n) {\n  if (!form || !form.states?.frm || !action) {\n    console.error('workflow_transition: Par\u00E2metros inv\u00E1lidos.');\n    return;\n  }\n  \n  // set the workflow_action for use in form scripts\n  frappe.dom.freeze();\n  form.states.frm.selected_workflow_action = action;\n  form.states.frm.script_manager.trigger('before_workflow_action').then(async () => {\n    await frappe\n      .xcall('frappe.model.workflow.apply_workflow', {\n        doc: form.states.frm.doc,\n        action: action\n      })\n      .then((doc: any) => {\n        frappe.model.sync(doc);\n        form.states.frm.refresh();\n        form.states.frm.selected_workflow_action = null;\n        form.states.frm.script_manager.trigger('after_workflow_action');\n      })\n      .finally(async () => {\n        frappe.dom.unfreeze();\n        callback && (await callback(form));\n      });\n  });\n};\n\nagt.utils.update_workflow_state = async function(params: {\n  doctype: string;\n  docname: string;\n  workflow_state: string;\n  ignore_workflow_validation?: boolean;\n  callback?: () => Promise<void>;\n}) {\n  const { doctype, docname, workflow_state, ignore_workflow_validation, callback } = params;\n  return await frappe\n    .call({\n      method: 'update_workflow_state',\n      args: { doctype, docname, workflow_state, ignore_workflow_validation }\n    })\n    .then(async () => {\n      return await agt.utils.refresh_force().then(async (doc: any) => {\n        callback && (await callback());\n        return doc;\n      });\n    });\n};\n\nagt.utils.refresh_force = async function() {\n  if (!cur_frm?.doc?.doctype || !cur_frm?.doc?.name) {\n    console.error('refresh_force: cur_frm ou documento inv\u00E1lido');\n    return undefined;\n  }\n  \n  frappe.model.clear_doc(cur_frm.doc.doctype, cur_frm.doc.name);\n  return await agt.utils.doc.get_doc(cur_frm.doc.doctype, cur_frm.doc.name)\n    .then((doc: any) => {\n      if (cur_frm?.states?.frm?.refresh) {\n        cur_frm.states.frm.refresh(); // Refresh the form\n      }\n      return doc;\n    })\n    .catch((error: any) => {\n      console.error('Error refreshing document:', error);\n      return undefined;\n    });\n};\n\n// Validation functions (moved here to avoid circular dependencies)\nagt.utils.validate_cpf_regex = function(cpf: string): boolean {\n  if (!cpf || typeof cpf !== 'string') return false;\n  cpf = cpf.trim();\n  return /^(?!000\\.000\\.000\\-00)(\\d{3}\\.\\d{3}\\.\\d{3}\\-\\d{2})$/.test(cpf);\n};\n\nagt.utils.validate_cnpj_regex = function(cnpj: string): boolean {\n  if (!cnpj || typeof cnpj !== 'string') return false;\n  cnpj = cnpj.trim();\n  return /^(?!00\\.000\\.000\\/0000\\-00)(\\d{2}\\.\\d{3}\\.\\d{3}\\/\\d{4}\\-\\d{2})$/.test(cnpj);\n};\n\nagt.utils.validate_cpf = function(cpf: string): boolean {\n  const d = (cpf || '').replace(/\\D/g, '');\n  if (d.length !== 11 || /^(\\d)\\1+$/.test(d)) return false;\n  let sum = 0;\n  for (let i = 0; i < 9; i++) sum += +(d[i] || 0) * (10 - i);\n  let check = (sum * 10) % 11;\n  if (check === 10) check = 0;\n  if (check !== +(d[9] || 0)) return false;\n  sum = 0;\n  for (let i = 0; i < 10; i++) sum += +(d[i] || 0) * (11 - i);\n  check = (sum * 10) % 11;\n  if (check === 10) check = 0;\n  return check === +(d[10] || 0);\n};\n\nagt.utils.validate_cnpj = function(cnpj: string): boolean {\n  const d = (cnpj || '').replace(/\\D/g, '');\n  if (d.length !== 14 || /^(\\d)\\1+$/.test(d)) return false;\n  const calc = (base: string, weights: number[]) => base.split('').reduce((sum, n, i) => sum + +(n || 0) * (weights[i] || 0), 0);\n  const w1 = [5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2];\n  const w2 = [6, ...w1];\n  let check = calc(d.slice(0, 12), w1) % 11;\n  let digit = check < 2 ? 0 : 11 - check;\n  if (digit !== +(d[12] || 0)) return false;\n  check = calc(d.slice(0, 13), w2) % 11;\n  digit = check < 2 ? 0 : 11 - check;\n  return digit === +(d[13] || 0);\n};\n\nagt.utils.validate_cnpj_existence = async function (cnpj: string): Promise<boolean> {\n  if (!cnpj || typeof cnpj !== 'string') return false;\n  \n  const digits = cnpj.replace(/\\D/g, '');\n  if (digits.length !== 14) return false;\n\n  try {\n    const response = await frappe.call({\n      method: 'check_cnpj',\n      args: { cnpj: digits }\n    });\n    const data = response?.message;\n    // Considera v\u00E1lido se n\u00E3o houver erro e o CNPJ retornado for igual ao consultado\n    return !!data && !!data.cnpj && data.cnpj.replace(/\\D/g, '') === digits;\n  } catch (error: any) {\n    console.error('Erro ao validar CNPJ:', error);\n    return false;\n  }\n};\n\nagt.utils.format_doc = function(doc: string, type?: string): string {\n  let digits = (doc || '').replace(/\\D/g, '');\n\n  const formatCpf = (d: string) => {\n    let formatted = d.slice(0, 11);\n    if (formatted.length > 3) formatted = formatted.replace(/^(\\d{3})(\\d)/, '$1.$2');\n    if (formatted.length > 6) formatted = formatted.replace(/^(\\d{3})\\.(\\d{3})(\\d)/, '$1.$2.$3');\n    if (formatted.length > 9) formatted = formatted.replace(/^(\\d{3})\\.(\\d{3})\\.(\\d{3})(\\d)/, '$1.$2.$3-$4');\n    return formatted;\n  };\n\n  const formatCnpj = (d: string) => {\n    let formatted = d.slice(0, 14);\n    if (formatted.length > 2) formatted = formatted.replace(/^(\\d{2})(\\d)/, '$1.$2');\n    if (formatted.length > 5) formatted = formatted.replace(/^(\\d{2})\\.(\\d{3})(\\d)/, '$1.$2.$3');\n    if (formatted.length > 8) formatted = formatted.replace(/^(\\d{2})\\.(\\d{3})\\.(\\d{3})(\\d)/, '$1.$2.$3/$4');\n    if (formatted.length > 12) formatted = formatted.replace(/^(\\d{2})\\.(\\d{3})\\.(\\d{3})\\/(\\d{4})(\\d)/, '$1.$2.$3/$4-$5');\n    return formatted;\n  };\n\n  if (type === 'Pessoa F\u00EDsica') {\n    return formatCpf(digits);\n  }\n  if (type === 'Pessoa Jur\u00EDdica') {\n    return formatCnpj(digits);\n  }\n  // Se n\u00E3o houver tipo, formata com base no comprimento\n  return digits.length < 12 ? formatCpf(digits) : formatCnpj(digits);\n};\n\n// Document ID validation function\nagt.utils.document_id = async function(frm: any, docField: string, typeField: string) {\n  const field = frm.fields_dict[docField];\n  if (!field?.$input) {\n    console.error(`document_id: O campo '${docField}' n\u00E3o foi encontrado ou n\u00E3o \u00E9 um campo de entrada v\u00E1lido.`);\n    return;\n  }\n  const $input = field.$input as any;\n\n  const setVisualStyle = (status: 'default' | 'warning' | 'error' | 'success') => {\n    let icon = '';\n    switch (status) {\n      case 'warning':\n        icon = '<i class=\"fa fa-exclamation-circle\" style=\"color:#f1c40f\"></i> ';\n        break;\n      case 'error':\n        icon = '<i class=\"fa fa-times-circle\" style=\"color:#e74c3c\"></i> ';\n        break;\n      case 'success':\n        icon = '<i class=\"fa fa-check-circle\" style=\"color:#27ae60\"></i> ';\n        break;\n      default:\n        icon = '';\n    }\n    return icon;\n  };\n\n  const updateUI = (color: string, message: string) => {\n    let status: 'default' | 'warning' | 'error' | 'success' = 'default';\n    if (color === '#f1c40f') status = 'warning';\n    else if (color === 'red' || color === '#e74c3c') status = 'error';\n    else if (color === 'green' || color === '#27ae60') status = 'success';\n    const icon = setVisualStyle(status);\n    field.set_description(icon + (message ? `<b style='color:${color}'>${message}</b>` : ''));\n  };\n\n  const validateAndStyle = () => {\n    const value = ($input.val() || '') as string;\n    const digits = value.replace(/\\D/g, '');\n    const docType = typeField ? frm.doc[typeField] : null;\n\n    // Make the field read-only and hidden if the document type is not valid  \n    if (docType && docType !== 'Pessoa F\u00EDsica' && docType !== 'Pessoa Jur\u00EDdica') {\n      frm.set_df_property(docField, 'read_only', 1);\n      frm.set_df_property(docField, 'hidden', 1);\n      updateUI('#f1c40f', 'Selecione o tipo de documento antes de preencher.');\n      return;\n    } else {\n      frm.set_df_property(docField, 'read_only', 0);\n      frm.set_df_property(docField, 'hidden', 0);\n    }\n\n    if (!digits) {\n      updateUI('', ''); // Clear the UI if no digits are present\n      return;\n    }\n\n    // { CPF logic }\n    if (docType === 'Pessoa F\u00EDsica') {\n      if (digits.length < 11) {\n        updateUI('#f1c40f', 'CPF incompleto');\n      } else {\n        if (agt.utils.validate_cpf(digits)) {\n          updateUI('green', 'CPF v\u00E1lido');\n        } else {\n          updateUI('red', 'CPF inv\u00E1lido. Favor corrigir.');\n        }\n      }\n      return;\n    }\n\n    // { CNPJ logic }\n    if (docType === 'Pessoa Jur\u00EDdica') {\n      if (digits.length < 14) {\n        updateUI('#f1c40f', 'CNPJ incompleto');\n      } else {\n        if (agt.utils.validate_cnpj(digits)) {\n          updateUI('#27ae60', 'CNPJ v\u00E1lido sintaticamente. Verificando exist\u00EAncia...');\n          agt.utils.validate_cnpj_existence(digits).then((exists: any) => {\n            if (exists) {\n              updateUI('green', 'CNPJ existe e est\u00E1 ativo');\n            } else {\n              updateUI('red', 'CNPJ n\u00E3o encontrado na base nacional');\n            }\n          });\n        } else {\n          updateUI('red', 'CNPJ inv\u00E1lido. Favor corrigir.');\n        }\n      }\n      return;\n    }\n\n    // { Ambiguous logic }\n    if (docType === null) {\n      if (digits.length < 11 || (digits.length > 11 && digits.length < 14)) {\n        updateUI('#f1c40f', 'CPF ou CNPJ incompleto.');\n      } else if (digits.length === 11) {\n        if (agt.utils.validate_cpf(digits)) {\n          updateUI('green', 'CPF v\u00E1lido');\n        } else {\n          updateUI('red', 'CPF ou CNPJ inv\u00E1lido ou incompleto');\n        }\n      } else if (digits.length >= 14) {\n        const cnpDigits = digits.slice(0, 14);\n        if (agt.utils.validate_cnpj(cnpDigits)) {\n          updateUI('green', 'CNPJ v\u00E1lido');\n        } else {\n          updateUI('red', 'CNPJ inv\u00E1lido. Favor corrigir.');\n        }\n      }\n    }\n  };\n\n  const formatOnInput = (e: any) => {\n    const input = e.target as HTMLInputElement;\n    const originalValue = input.value;\n    const docType = typeField ? frm.doc[typeField] : null;\n\n    // Store the cursor position before formatting\n    const originalPos = input.selectionStart || 0;\n    const digitsBeforeCursor = (originalValue.slice(0, originalPos).replace(/\\D/g, '')).length;\n\n    // Extract only digits and limit length based on document type\n    let digits = originalValue.replace(/\\D/g, '');\n    const maxLength = docType === 'Pessoa Jur\u00EDdica' ? 14 : (docType === 'Pessoa F\u00EDsica' ? 11 : 14);\n    if (digits.length > maxLength) {\n      digits = digits.slice(0, maxLength);\n    }\n\n    const formatCpf = (d: string) => d.replace(/(\\d{3})(\\d)/, '$1.$2').replace(/(\\d{3})\\.(\\d{3})(\\d)/, '$1.$2.$3').replace(/(\\d{3})\\.(\\d{3})\\.(\\d{3})(\\d{1,2})/, '$1.$2.$3-$4');\n    const formatCnpj = (d: string) => d.replace(/(\\d{2})(\\d)/, '$1.$2').replace(/(\\d{2})\\.(\\d{3})(\\d)/, '$1.$2.$3').replace(/(\\d{2})\\.(\\d{3})\\.(\\d{3})(\\d)/, '$1.$2.$3/$4').replace(/(\\d{2})\\.(\\d{3})\\.(\\d{3})\\/(\\d{4})(\\d)/, '$1.$2.$3/$4-$5');\n\n    let formattedValue = digits;\n    if (docType === 'Pessoa F\u00EDsica') {\n      formattedValue = formatCpf(digits);\n    } else if (docType === 'Pessoa Jur\u00EDdica') {\n      formattedValue = formatCnpj(digits);\n    } else {\n      formattedValue = digits.length > 11 ? formatCnpj(digits) : formatCpf(digits);\n    }\n\n    // Apply the formatted value and adjust the cursor\n    if (originalValue !== formattedValue) {\n      input.value = formattedValue;\n      frm.doc[docField] = formattedValue;\n\n      // Recalcula a nova posi\u00E7\u00E3o do cursor\n      let newCursorPos = 0;\n      let digitsCounted = 0;\n      for (const char of formattedValue) {\n        newCursorPos++;\n        if (/\\d/.test(char)) digitsCounted++;\n        if (digitsCounted >= digitsBeforeCursor) break;\n      }\n      while (newCursorPos < formattedValue.length && formattedValue[newCursorPos] && /\\D/.test(formattedValue[newCursorPos] || '')) {\n        newCursorPos++;\n      }\n      input.setSelectionRange(newCursorPos, newCursorPos);\n    }\n\n    // Performs validation for real-time feedback\n    validateAndStyle();\n  };\n\n  // Attach events to the input field\n  $input.off('.cpfcnpj').on('input.cpfcnpj', formatOnInput);\n\n  // Revalidate if the type field changes\n  if (typeField && frm.fields_dict[typeField]?.$input) {\n    frm.fields_dict[typeField].$input.off(`.cpfcnpjtype_${docField}`).on(`change.cpfcnpjtype_${docField}`, () => {\n      validateAndStyle(); // Directly call the validation/style function\n      $input.trigger('input.cpfcnpj'); // Optional: keep formatting if needed\n    });\n  }\n  // Perform initial validation\n  validateAndStyle();\n};\n\nagt.utils.redirect_by_ref = function(ref?: string, title?: string, message?: string, indicator?: string, url?: string, delay = 3000, newTab = true) {\n  if (!ref || !url) {\n    console.error('redirect_by_ref: ref e url s\u00E3o obrigat\u00F3rios');\n    return;\n  }\n\n  frappe.msgprint({\n    title: title || 'Redirecionando...',\n    message: message ?? \"\",\n    indicator: indicator || 'blue'\n  });\n\n  setTimeout(() => {\n    if (url) {\n      if (newTab) {\n        window.open(url, '_blank');\n      } else {\n        window.location.href = url;\n      }\n    }\n  }, delay);\n};\n\nagt.utils.build_doc_url = function(doctype: string, docname: string): string {\n  const doctypeSlug = doctype\n    .replace(/([a-z])([A-Z])/g, '$1-$2')\n    .replace(/\\s+/g, '-')\n    .replace(/_/g, '-')\n    .toLowerCase();\n  return `${window.location.origin}/app/${doctypeSlug}/${encodeURIComponent(docname)}`;\n};\n\nagt.utils.redirect_after_create_doc = function(success: boolean, url: string, docname: string, doctype: string): void {\n  if (success) {\n    frappe.msgprint({\n      title: \"Redirecionando...\",\n      message: `${doctype} criado com sucesso! Voc\u00EA ser\u00E1 direcionado para o documento (${docname}).`,\n      indicator: \"green\"\n    });\n  } else {\n    frappe.msgprint({\n      title: \"Redirecionando...\",\n      message: `Voc\u00EA ser\u00E1 direcionado para o documento j\u00E1 existente (${docname}).`,\n      indicator: \"blue\"\n    });\n  }\n  setTimeout(() => {\n    window.location.href = url;\n  }, 2000);\n};\n\nagt.utils.get_item_info = async function(item_name: string, sn?: string) {\n  if (!item_name || typeof item_name !== 'string') {\n    console.error('get_item_info: item_name \u00E9 obrigat\u00F3rio');\n    return;\n  }\n  \n  const all_items = await frappe.db\n    .get_list('Item', {\n      fields: ['item_code', 'custom_mppt', 'item_name'],\n    })\n    .catch((e: any) => {\n      console.error('Erro ao buscar itens:', e);\n      return null;\n    });\n\n  if (!all_items || !all_items.length) return;\n\n  // Busca flex\u00EDvel usando normalize_text apenas com item_name\n  const normalizedInput = agt.utils.text.normalize(item_name);\n  const filtered_items = all_items.filter((item: any) =>\n    agt.utils.text.normalize(item.item_name) === normalizedInput\n  );\n\n  if (!filtered_items.length) return;\n  // Se s\u00F3 existe um MPPT, retorna direto\n  const uniqueMppts = [...new Set(filtered_items.map((item: any) => item.custom_mppt))];\n  if (uniqueMppts.length === 1) return filtered_items[0];\n\n  // Se h\u00E1 mais de um MPPT, mostra o di\u00E1logo para sele\u00E7\u00E3o\n  const dialog_title = `Selecione a quantidade de MPPTs (${item_name}${sn ? ` - ${sn}` : ''})`;\n  return new Promise<any>(resolve => {\n    agt.utils.dialog.load({\n      title: dialog_title,\n      fields: [\n        {\n          fieldname: 'mppt',\n          label: 'MPPT',\n          fieldtype: 'Select',\n          options: uniqueMppts,\n          reqd: true\n        }\n      ],\n      static: false,\n      draggable: false,\n      lockClose: true,\n      primary_action: async function (values: any) {\n        const mppt = values.mppt;\n        if (!mppt) return;\n        const item = filtered_items.find((item: any) => item.custom_mppt === mppt);\n        agt.utils.dialog.close_by_title(dialog_title);\n        resolve(item); // Resolve o item selecionado\n      }\n    });\n  });\n};\n\nagt.utils.get_growatt_sn_info = async function(serial_no: string) {\n  if (!serial_no || typeof serial_no !== 'string') {\n    console.error('get_growatt_sn_info: serial_no \u00E9 obrigat\u00F3rio');\n    return undefined;\n  }\n  \n  try {\n    const sn = await frappe.call({\n      method: 'get_growatt_sn_info',\n      args: { deviceSN: serial_no }\n    });\n    const fail = !sn || !sn.message?.code || sn.message.code !== 200;\n    if (fail) return undefined;\n    return sn.message;\n  } catch (error: any) {\n    console.error('Erro ao buscar informa\u00E7\u00F5es do SN Growatt:', error);\n    return undefined;\n  }\n};\n\nagt.utils.validate_serial_number = function(sn: string, type?: 'inverter' | 'battery' | 'ev_charger' | 'transformer' | 'smart_meter' | 'smart_energy_manager' | 'other'): boolean {\n  if (!sn || typeof sn !== 'string') return false;\n\n  sn = sn.trim().toUpperCase();\n\n  const sn_regex = /^[A-Z0-9][A-Z][A-Z0-9]([A-Z0-9]{7}|[A-Z0-9]{13})$/;\n  const iv_sn_regex = /^[A-Z0-9]{3}[A-Z0-9]{7}$/;\n  const other_sn_regex = /^[A-Z0-9]{3}[A-Z0-9]{13}$/;\n\n  let output = false;\n  if (type === 'inverter') {\n    output = iv_sn_regex.test(sn);\n  } else if (type === 'battery' || type === 'ev_charger') {\n    output = other_sn_regex.test(sn);\n  } else {\n    output = sn_regex.test(sn);\n  }\n  return output;\n};\n\nagt.utils.get_value_from_any_doc = async function(\n  frm: any,\n  doctype: string,\n  docnameField: string,\n  fieldName: string\n): Promise<any> {\n  const docname = frm.doc[docnameField];\n  if (!docname) return null;\n  try {\n    const result = await frappe.db.get_doc(doctype, docname);\n    return result?.[fieldName] ?? null;\n  } catch (e) {\n    console.error(`Erro ao buscar campo ${fieldName} do ${doctype}:`, e);\n    return null;\n  }\n};", "import { JoinStep } from \"@anygridtech/frappe-agt-types/agt/client/utils/db\";\n\nfrappe.provide('agt.db');\n\nagt.db.filter_join = async function <Steps extends readonly JoinStep[]>(\n  steps: Steps\n): Promise<\n  Steps extends [...any, infer Last]\n  ? Last extends JoinStep<infer T>\n  ? T[]\n  : any[]\n  : any[]\n> {\n  // Inferir o tipo do resultado final\n  type Result = Steps extends [...any, infer Last]\n    ? Last extends JoinStep<infer T>\n    ? T[]\n    : any[]\n    : any[];\n\n  let results: Result = [] as unknown as Result;\n\n  for (let i = 0; i < steps.length; i++) {\n    const step = steps[i];\n    if (!step) continue;\n\n    const filters = { ...step.filters };\n    if (i > 0 && step.joinOn && (results as any[]).length > 0) {\n      const joinOn = step.joinOn;\n      const joinValues = (results as any[]).map(item => item[joinOn.sourceField]);\n      filters[joinOn.targetField] = [\"in\", joinValues];\n    }\n\n    if (step.joinOn && (results as any[]).length === 0) {\n      console.warn(`No results found for step ${i + 1}. Skipping further joins.`);\n      break;\n    }\n\n    const response = await frappe.call({\n      method: \"backend_get_all\",\n      args: {\n        doctype: step.doctype,\n        filters,\n        fields: step.fields,\n      }\n    });\n\n    results = (response.message.data || []) as Result;\n  }\n\n  return results;\n};", "frappe.provide('agt.utils.dialog');\n\nagt.utils.dialog.created = [];\n\nagt.utils.dialog.load = function(diagConfig: any) {\n  const dialog = new frappe.ui.Dialog(diagConfig);\n\n  // Adiciona ao array de di\u00E1logos antes de mostrar\n  agt.utils.dialog.created.push(dialog);\n\n  // Configura evento para quando o di\u00E1logo fechar (via \"\u00D7\" ou ESC)\n  $(dialog['wrapper']).on('hidden.bs.modal', () => {\n    const index = agt.utils.dialog.created.indexOf(dialog);\n    if (index > -1) {\n      agt.utils.dialog.created.splice(index, 1);\n      agt.utils.dialog.refresh_dialog_stacking();\n    }\n  });\n\n  // Mostra o di\u00E1logo\n  dialog.show();\n\n  // Aplica z-index ap\u00F3s o di\u00E1logo estar vis\u00EDvel\n  setTimeout(() => agt.utils.dialog.refresh_dialog_stacking(), 50);\n\n  return dialog;\n};\n\nagt.utils.dialog.close_all = function() {\n  // Captura os di\u00E1logos antes de fech\u00E1-los\n  const dialogs = [...agt.utils.dialog.created];\n\n  // Fecha cada di\u00E1logo\n  dialogs.forEach((dialog: any) => {\n    if (dialog) {\n      dialog.hide();\n      // Remova o backdrop manualmente\n      const $backdrop = $(dialog['wrapper']).data(\"bs.modal\")?.$backdrop;\n      $backdrop?.remove();\n    }\n  });\n\n  // Limpa o array\n  agt.utils.dialog.created = [];\n};\n\nagt.utils.dialog.close_by_title = function(title: string) {\n  const dialogIndex = agt.utils.dialog.created.findIndex((d: any) => d.title === title);\n  if (dialogIndex >= 0) {\n    const dialog = agt.utils.dialog.created[dialogIndex];\n    if (dialog) {\n      dialog.hide();\n\n      // Remova o backdrop manualmente\n      const $backdrop = $(dialog['wrapper']).data(\"bs.modal\")?.$backdrop;\n      $backdrop?.remove();\n\n      // Remove o di\u00E1logo da lista\n      agt.utils.dialog.created.splice(dialogIndex, 1);\n\n      // Reaplica o z-index para os di\u00E1logos restantes\n      agt.utils.dialog.refresh_dialog_stacking();\n    }\n  }\n};\n\nagt.utils.dialog.show_debugger_alert = function(_frm: any, message: string, indicator: string, timeout: number = 10) {\n  if (frappe.user.has_role(['IT', 'Administrator', 'System Manager'])) {\n    frappe.show_alert({ message: __(message), indicator: indicator }, timeout);\n  }\n};\n\nagt.utils.dialog.refresh_dialog_stacking = function() {\n  if (typeof $ === 'undefined') {\n    console.error('jQuery is not loaded. Unable to refresh dialog stacking.');\n    return;\n  }\n\n  // Base z-index para modal e backdrop\n  const baseModalIndex = 1051;\n  const baseBackdropIndex = 1050;\n\n  // Para cada di\u00E1logo em ordem de cria\u00E7\u00E3o\n  agt.utils.dialog.created.forEach((dialog: any, index: number) => {\n    // Verifica se o di\u00E1logo est\u00E1 vis\u00EDvel\n    if ($(dialog['wrapper']).is(':visible')) {\n      // Configura z-index com incremento para cada di\u00E1logo\n      const zIndex = baseModalIndex + (index * 2);\n\n      // Aplica ao modal\n      $(dialog['wrapper']).css('z-index', zIndex);\n\n      // Encontra e aplica ao backdrop correspondente\n      const modalId = $(dialog['wrapper']).attr('id');\n      $(`.modal-backdrop[data-modal-id=\"${modalId}\"]`).css('z-index', baseBackdropIndex + (index * 2));\n\n      // Associa ID do modal ao backdrop para facilitar a correspond\u00EAncia\n      const $backdrop = $(dialog['wrapper']).data(\"bs.modal\")?.$backdrop;\n      if ($backdrop && !$backdrop.attr('data-modal-id')) {\n        $backdrop.attr('data-modal-id', modalId);\n      }\n    }\n  });\n};", "frappe.provide('agt.utils.doc');\n\nagt.utils.doc.create_doc = async function(\n  doctype: string,\n  fields_target: string[],\n  fields_dict: Record<string, any>\n): Promise<string | undefined> {\n  const meta = await agt.utils.doc.get_doc_meta(doctype);\n  if (!meta) {\n    frappe.throw(`Could not fetch meta for doctype: ${doctype}`);\n    return;\n  }\n\n  const fields_record = Object.entries(fields_dict).reduce((acc, [k, v]) => {\n    if (typeof v.value === \"number\" || typeof v.value === \"string\") {\n      acc[k] = v.value;\n    }\n    return acc;\n  }, {} as Record<string, string | number>);\n\n  const valid_fields = meta.fields.map((field: any) => field.fieldname);\n\n  // Novo formato obrigat\u00F3rio: fields_target \u00E9 um array de nomes de campos a copiar do cur_frm.doc\n  for (const targetField of fields_target) {\n    if (!valid_fields.includes(targetField)) continue;\n\n    let value: any;\n    if (targetField === \"docname\" && cur_frm?.docname) {\n      value = cur_frm.docname;\n    } else if (cur_frm?.doc && targetField in cur_frm.doc) {\n      value = (cur_frm.doc as any)[targetField];\n    }\n\n    if (value !== undefined) {\n      fields_record[targetField] = value;\n    }\n  }\n\n  // Filtra apenas fields v\u00E1lidos\n  const valid_updates: Record<string, any> = {};\n  for (const [fieldname, field] of Object.entries(fields_record)) {\n    if (!valid_fields.includes(fieldname)) continue;\n    // Simple validation: skip empty/null/undefined values\n    if (field === undefined || field === null || field === '') continue;\n    valid_updates[fieldname] = field;\n  }\n\n  if (Object.keys(valid_updates).length === 0) {\n    frappe.throw(`No valid fields to create the document: ${doctype}`);\n    return;\n  }\n\n  // Cria doc novo\n  const doc = frappe.model.get_new_doc(doctype);\n\n  // Aplica atualiza\u00E7\u00F5es v\u00E1lidas\n  for (const [name, value] of Object.entries(valid_updates)) {\n    if (name === \"workflow_state\" || name === \"naming_series\") continue;\n    doc[name] = value;\n  }\n\n  // Salva doc\n  const r1 = await frappe.db.insert(doc).catch((e: any) => console.error(e));\n  return r1?.name;\n};\n\nagt.utils.doc.update_doc = async function(\n  doctype: string,\n  docname: string,\n  fields_record: Record<string, any>,\n  retryCount = 0\n): Promise<void> {\n  const maxRetries = 3; // Limit retries to prevent infinite loops\n  if (retryCount >= maxRetries) {\n    console.error(`Max retries (${maxRetries}) reached. Aborting update.`);\n    return;\n  }\n  try {\n    // Fetch the latest document\n    const doc = await frappe.db.get_doc(doctype, docname).catch((e: any) => console.error(e));\n    if (!doc) {\n      console.error(`Document '${docname}' not found.`);\n      return;\n    }\n\n    // Determine valid updates\n    const valid_updates: Record<string, any> = {};\n    const ignore_fields = ['workflow_state', 'naming_series', 'creation', 'doctype', 'modified', 'name', 'owner'];\n    for (const [f, v] of Object.entries(fields_record)) {\n      if (ignore_fields.includes(f) && doctype !== 'Serial No') continue;\n      if (doc[f] === undefined) continue;\n      if (doc[f] === v) continue;\n      if (doc[f] === null && v === '') continue;\n      if (doc[f] === '' && v === null) continue;\n      console.log(`[${doctype} - ${docname}] Setting ${f} to ${v}`);\n      doc[f] = v;\n      valid_updates[f] = v;\n    }\n\n    if (Object.keys(valid_updates).length === 0) {\n      console.log(`[${doctype} - ${docname}] No valid fields to update`);\n      return;\n    }\n\n    // Save the updated document\n    await frappe.call({\n      method: 'frappe.client.save',\n      args: { doc }\n    });\n\n    if (doctype === cur_frm.doctype && docname === cur_frm.docname) {\n      // Fetch the latest version of the document from the server\n      const updatedDoc = (await frappe\n        .call({\n          method: 'frappe.client.get',\n          args: { doctype, name: docname }\n        })\n        .then(({ message }: any) => message)) as any;\n\n      frappe.model.sync([updatedDoc]);\n\n      cur_frm.states.frm.refresh();\n    }\n\n    console.log(`Document '${docname}' updated successfully.`);\n  } catch (error) {\n    // Check for timestamp mismatch\n    if ((error as unknown as any)?.message?.includes('Document has been modified after you have opened it')) {\n      console.warn('Timestamp mismatch detected. Refetching document...');\n      return await agt.utils.doc.update_doc(doctype, docname, fields_record, retryCount + 1);\n    } else {\n      console.error(`Error saving document '${docname}':`, error);\n    }\n  }\n};\n\nagt.utils.doc.get_doc = async function(doctype: string, docname: string) {\n  return await frappe\n    .call({\n      method: 'frappe.client.get',\n      args: { doctype, name: docname }\n    })\n    .then(async (doc: any) => {\n      // Update locals manually\n      frappe.model.clear_doc(doctype, docname); // Clears old cache\n      frappe.model.sync([doc.message]); // Syncs the fresh document\n      cur_frm.states.frm.refresh(); // Refresh the form\n      return doc.message; // Return the latest document\n    });\n};\n\nagt.utils.doc.share_doc = async function(doctype: string, docname: string, users: any[]) {\n  const shared_users = (await frappe\n    .call({\n      method: 'frappe.share.get_users',\n      args: { doctype: doctype, name: docname }\n    })\n    .then(({ message }: any) => message)) as any[];\n  for (const user of users) {\n    const shared = shared_users.find(u => u.user === user.user);\n    if (shared?.read === user.read && shared?.write === user.write && shared?.share === user.share) {\n      console.log(`Document '${docname}' already shared with user '${user.user}'`);\n      continue;\n    }\n    await frappe\n      .call({\n        method: 'frappe.share.add',\n        args: {\n          doctype: doctype,\n          name: docname,\n          user: user.user,\n          read: user.read,\n          write: user.write,\n          share: user.share,\n          owner: user.owner || frappe.session.user_email\n        }\n      })\n      .then(() => console.log(`Document '${docname}' shared with user '${user.user}'`));\n  }\n};\n\nagt.utils.doc.get_doc_meta = async function(doctype: string) {\n  await frappe.model.with_doctype(doctype);\n  return frappe.get_meta(doctype);\n};", "frappe.provide('agt.utils.form');\nfrappe.provide('agt.utils.form.field');\n\nagt.utils.form.field.is_empty = function(value: string): boolean {\n  if (!value) return true;\n  const text = value.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, '').trim();\n  return text === '';\n};\n\nagt.utils.form.field.set_properties = function(frm: any, configs: Record<string, any>): void {\n  Object.entries(configs).forEach(([fieldname, opts]) => {\n    if (opts.hidden !== undefined) {\n      const $el = frm.$wrapper.find(`[data-fieldname='${fieldname}']`);\n      $el.toggle(!opts.hidden);\n    }\n    if (opts.readonly !== undefined) {\n      frm.set_df_property(fieldname, 'read_only', opts.readonly ? 1 : 0);\n    }\n    if (opts.reqd !== undefined) {\n      frm.set_df_property(fieldname, 'reqd', opts.reqd ? 1 : 0);\n    }\n    if (opts.label !== undefined) {\n      frm.set_df_property(fieldname, 'label', opts.label);\n    }\n    if (opts.description !== undefined) {\n      frm.set_df_property(fieldname, 'description', opts.description);\n    }\n  });\n  frm.refresh_fields();\n};\n\nagt.utils.form.field.get_js_visible_fields = function(form: any) {\n  const visible_fields: any[] = [];\n  for (let field of Object.values(form.fields_dict) as any[]) {\n    if (['Table', 'Section Break', 'Column Break', 'HTML', 'Fold'].includes(field.df.fieldtype)) continue;\n    if (!field.df.depends_on) continue;\n    const depends_on_json_fnc = field.df.depends_on.replace('eval:', '') as string;\n    const is_visible = frappe.utils.eval(depends_on_json_fnc, {\n      doc: form.doc\n    });\n    if (is_visible) visible_fields.push(field);\n  }\n  return visible_fields;\n};\n\nagt.utils.form.field.validate_js_visible_fields = function(form: any, workflow_state: string) {\n  const js_visible_fields = agt.utils.form.field.get_js_visible_fields(form);\n  const title = __('Aten\u00E7\u00E3o!');\n  const indicator = 'red';\n  function validate_js_visible_fields_msg(fields: any[]) {\n    const throw_html: string[] = [];\n    for (let field of fields as any[]) {\n      throw_html.push(`<li>${field.df.label}</li>`);\n    }\n    const msg = `<p>${__('\u26A0\uFE0F Os campos abaixo s\u00E3o obrigat\u00F3rios: ')}</p>` + `<ul>${throw_html.join('')}</ul>`;\n    return msg;\n  }\n  const throw_error = () => {\n    if (workflow_state !== form.doc.workflow_state) return;\n    if (!js_visible_fields.length) return;\n    const message = validate_js_visible_fields_msg(js_visible_fields);\n    frappe.throw({ title, message, indicator });\n  };\n  const msgprint = () => {\n    if (workflow_state !== form.doc.workflow_state) return;\n    if (!js_visible_fields.length) return;\n    const message = validate_js_visible_fields_msg(js_visible_fields);\n    frappe.msgprint({ title, message, indicator });\n  };\n  return { throw_error, msgprint };\n};\n\nagt.utils.form.field.turn_into_link = function(frm: any, fieldName: string, docType: string) {\n  const field = frm.fields_dict[fieldName];\n  if (field && field.df.read_only && field.$wrapper) {\n    const $wrapper = field.$wrapper;\n    $wrapper.css(\"position\", \"relative\");\n    $wrapper.find(\".serial-link-mask\").remove();\n    $wrapper.append(\n      `<a class=\"serial-link-mask\" href=\"/app/${docType}/${encodeURIComponent(frm.doc[fieldName])}\" target=\"_blank\"\n        style=\"position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;z-index:10;cursor:pointer;\"></a>`\n    );\n  }\n};\n\nagt.utils.form.mirror_checklist_table = async function(form: any, doctype: string, tableField: string, childname: string, docname: string, workflowStateField?: string) {\n  const name = form.doc.name;\n  // Fetch remote records with the additional workflow_state field if necessary\n  const fields = ['name'];\n  if (workflowStateField) fields.push('workflow_state');\n\n  const remote = await frappe.db.get_list(doctype, {\n    filters: { [childname]: name },\n    fields: fields\n  }).catch((e: any) => { console.error(`Error fetching ${doctype}:`, e); return []; });\n\n  const currentTable = (form.doc[tableField] || []) as any[];\n\n  // Check for differences between the current table and remote data, including workflow_state if necessary\n  let needsUpdate = !await agt.utils.table.is_sync(currentTable, remote, docname, workflowStateField);\n\n  // If there are no differences, do nothing\n  if (!needsUpdate) {\n    console.log(`Tabela '${tableField}' j\u00E1 est\u00E1 sincronizada.`);\n    return;\n  }\n\n  // Update the table with the new data\n  form.doc[tableField] = remote.map((item: any) => {\n    const row = { [docname]: item.name };\n    if (workflowStateField && item.workflow_state) {\n      row[workflowStateField] = item.workflow_state;\n    }\n    return row;\n  });\n  form.dirty();\n  form.refresh_field(tableField);\n  await form.save();\n  console.log(`Tabela '${tableField}' sincronizada.`);\n};\n\nagt.utils.form.assign_parent_doc_name = function(_form: any) {\n  // if (!form?.doc || form.doc.__islocal) return;\n\n  // const meta = frappe.get_meta?.(form.doc.doctype);\n  // const hasField = meta?.fields?.some(f => f.fieldname === \"ref_naming_series\");\n\n  // if (hasField && !form.doc.ref_naming_series && form.doc.name) {\n  //   form.set_value(\"ref_naming_series\", form.doc.name);\n  // }\n};\n\nagt.utils.form.adjust_html_elements = function(form: any, options: any): void {\n  // if (!form?.doc || form.doc.__islocal) return;\n  if (!form?.doc) return;\n\n  const elementsToRemove = {\n    removeTabs: '.form-tabs-list',\n    removeNavFormsTabs: '.nav.form-tabs',\n    removeSidebar: '.col-lg-2.layout-side-section',\n    removeAssignments: '.form-assignments',\n    removeAssignmentsButton: '.button.add-assignments-btn',\n    removeAttachments: '.form-attachments',\n    removeAttachmentsButton: '.button.add-attachments-btn',\n    removeShared: '.form-shared',\n    removeTags: '.form-tags',\n    removeSidebarStats: '.form-sidebar-stats',\n    removeSidebarMenu: '.list-unstyled.sidebar-menu.text-muted',\n    removeSidebarReset: 'button.btn-reset.sidebar-toggle-btn',\n    removeSidebarToggle: 'span.sidebar-toggle-btn',\n    removeActivityBar: '.form-footer',\n  };\n\n  Object.entries(elementsToRemove).forEach(([option, selector]) => {\n    if (options[option as keyof typeof options]) {\n      const el = document.querySelector(selector);\n      if (el) {\n        (el as HTMLElement).style.display = 'none';\n        el.remove();\n      }\n    }\n  });\n  if (options.removeTabs && !document.querySelector('.form-tabs-list')) {\n    document.querySelector('.form-layout')?.setAttribute('style', 'border-top: none');\n  }\n};\n\nagt.utils.form.render_doc_fields_table = async function(\n  wrapper: any,\n  docOrRows: any,\n  fields: any[],\n  meta?: any\n): Promise<void> {\n  if (!wrapper || !docOrRows || !fields?.length) {\n    console.error('[render_doc_fields_table] Invalid arguments!');\n    return;\n  }\n  const isTable = Array.isArray(docOrRows) || (\n    typeof docOrRows === 'object' && docOrRows !== null && 'length' in docOrRows && typeof (docOrRows as any).length === 'number'\n  );\n  const arr: Record<string, unknown>[] = isTable\n    ? Array.isArray(docOrRows)\n      ? (docOrRows as unknown[]).filter((el): el is Record<string, unknown> => typeof el === 'object' && el !== null)\n      : Array.from(docOrRows as any).filter((el: any): el is Record<string, unknown> => typeof el === 'object' && el !== null)\n    : [];\n  if (!meta) {\n    const doctype = isTable && arr.length > 0 ? arr[0]?.['doctype'] : (docOrRows as any)?.['doctype'];\n    if (doctype) meta = await frappe.get_meta?.(doctype as string);\n  }\n  // HTML escape helper to prevent XSS\n  const escapeHtml = (value: unknown): string => {\n    if (value === null || value === undefined) return '';\n    const str = String(value);\n    return str\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#x27;');\n  };\n\n  const getFieldMeta = (field: { fieldname: string; label?: string }) => {\n    const metaField = meta?.fields?.find((f: any) => f.fieldname === field.fieldname);\n    return {\n      label: field.label || metaField?.label || field.fieldname,\n      fieldtype: metaField?.fieldtype || 'Data',\n      options: metaField?.options\n    };\n  };\n  const autoFormat = (value: unknown, fieldtype: string, options?: unknown): string => {\n    if (value === null || value === undefined || value === '') return '<span class=\"text-muted\">\u2014</span>';\n    switch (fieldtype) {\n      case 'Link':\n        if (options && value != null) {\n          const slug = String(options).toLowerCase().replace(/\\s+/g, '-');\n          const escapedValue = escapeHtml(value);\n          return `<a href=\"/app/${escapeHtml(slug)}/${encodeURIComponent(String(value))}\" target=\"_blank\">${escapedValue}</a>`;\n        }\n        return escapeHtml(value);\n      case 'Select':\n        return `<span class=\"badge badge-light\">${escapeHtml(value)}</span>`;\n      case 'Date':\n      case 'Datetime':\n        const dateValue = frappe?.datetime?.str_to_user ? frappe.datetime.str_to_user(value as string) : String(value);\n        return escapeHtml(dateValue);\n      case 'Currency':\n      case 'Float':\n      case 'Int':\n        const formattedValue = (window as any).frappe?.format_value ? (window as any).frappe.format_value(value, { fieldtype }) : String(value);\n        return escapeHtml(formattedValue);\n      case 'Check':\n        return value ? '<span class=\"text-success\">\u2713 Sim</span>' : '<span class=\"text-danger\">\u2717 N\u00E3o</span>';\n      default:\n        return escapeHtml(value);\n    }\n  };\n  let rows = '';\n  let thead = '';\n  if (isTable) {\n    if (arr.length === 0) {\n      rows = `<tr><td colspan=\"${fields.length}\" class=\"text-center text-muted\">Nenhum dado encontrado.</td></tr>`;\n    } else {\n      rows = arr.map(row =>\n        '<tr>' + fields.map(field => {\n          const metaF = getFieldMeta(field);\n          const value = row[field.fieldname];\n          const displayValue = field.formatter ? field.formatter(value, row, metaF) : autoFormat(value, metaF.fieldtype, metaF.options);\n          return `<td${metaF.fieldtype === 'Link' ? ' data-debug-link=\"true\"' : ''}>${displayValue}</td>`;\n        }).join('') + '</tr>'\n      ).join('');\n      thead = '<tr>' + fields.map(field => {\n        const metaF = getFieldMeta(field);\n        const label = field.label || metaF.label || field.fieldname;\n        return `<th class=\"text-muted\">${escapeHtml(label)}</th>`;\n      }).join('') + '</tr>';\n    }\n  } else {\n    rows = fields.map(field => {\n      const metaF = getFieldMeta(field);\n      const value = (docOrRows as Record<string, unknown>)[field.fieldname];\n      const displayValue = field.formatter ? field.formatter(value, docOrRows as Record<string, unknown>, metaF) : autoFormat(value, metaF.fieldtype, metaF.options);\n      const label = field.label || metaF.label || field.fieldname;\n      return `<tr><td>${escapeHtml(label)}</td><td>${displayValue}</td></tr>`;\n    }).join('');\n  }\n  const table_html = `<div class=\"form-section\" style=\"margin-bottom: 16px;\">\n      <div class=\"table-responsive\" style=\"border: 1px solid var(--border-color); border-radius: var(--border-radius); overflow: hidden;\">\n        <table class=\"table table-bordered\" style=\"margin: 0; border: none;\">\n          ${thead ? `<thead class=\"table-header\">${thead}</thead>` : ''}\n          <tbody>\n            ${rows}\n          </tbody>\n        </table>\n      </div>\n    </div>`;\n  if (typeof (wrapper as { html: (html: string) => void }).html === 'function') {\n    (wrapper as { html: (html: string) => void }).html(table_html);\n  } else if (typeof window !== 'undefined' && (window as any).jQuery && wrapper instanceof (window as any).jQuery) {\n    (wrapper as any).html(table_html);\n  } else if (wrapper instanceof HTMLElement) {\n    wrapper.innerHTML = table_html;\n  }\n};\n\nagt.utils.form.set_button_primary_style = function(frm: any, fieldname: string): void {\n  const field = frm.fields_dict[fieldname];\n  if (!field?.$input) {\n    console.warn(`Campo '${fieldname}' n\u00E3o encontrado ou n\u00E3o \u00E9 um bot\u00E3o v\u00E1lido.`);\n    return;\n  }\n\n  if (field.df.fieldtype === 'Button') {\n    const $button = field.$input;\n    if ($button && $button.length) {\n      $button.removeClass('btn-default btn-secondary btn-success btn-warning btn-danger btn-info btn-light btn-dark');\n      $button.addClass('btn-primary');\n    }\n  } else {\n    console.warn(`Campo '${fieldname}' n\u00E3o \u00E9 do tipo Button.`);\n  }\n};\n\nagt.utils.form.transport_values = function(targetForm: any, field: string) {\n  if (!agt.src_frm) return;\n  if (!targetForm.doc.__islocal) return;\n\n  const fieldNames = targetForm.meta.fields.map((f: any) => f.fieldname);\n  Object.entries(agt.src_frm.fields_dict).forEach(([key, field]: any) => {\n    if (!field.value || (typeof field.value === 'string' && field.value.trim() === '')) return;\n    if (!fieldNames.includes(key)) return;\n    if (targetForm.doc[key] === field.value) return;\n    console.log(`Setting ${key} to ${field.value}`);\n    targetForm.set_value(key, field.value);\n  });\n  targetForm.set_value(field, agt.src_frm.docname);\n  targetForm.save();\n};", "frappe.provide('agt.utils.table');\nfrappe.provide('agt.utils.table.row');\n\nagt.utils.table.row.add_one = async function<T>(form: any, child_doctype: string, fields_record: T): Promise<T> {\n  const snake_child_doctype = agt.utils.text.to_snake_case(child_doctype);\n  const child = form.add_child(snake_child_doctype, fields_record);\n  form.dirty(); // Mark as dirty to make sure the changes will be saved\n  form.refresh_field(snake_child_doctype);\n  await form.save();\n  return child as T;\n};\n\nagt.utils.table.row.add_many = async function<T>(form: any, child_doctype: string, fields_record_arr: T[]): Promise<T[]> {\n  const snake_child_doctype = agt.utils.text.to_snake_case(child_doctype);\n  const children: T[] = [];\n  fields_record_arr.forEach((fields_record: T) => {\n    const child = form.add_child(snake_child_doctype, fields_record);\n    children.push(child as T);\n  });\n  form.dirty(); // Mark as dirty to make sure the changes will be saved\n  form.refresh_field(snake_child_doctype);\n  await form.save();\n  return children;\n};\n\nagt.utils.table.row.update_one = async function(frm: any, fields_record: Record<string, string | number | null>) {\n  // For child table rows, use the doctype directly, fallback to parenttype if doctype is not available\n  const doctype_to_use = frm.doctype || frm.parenttype || 'Unknown';\n  await Promise.all(\n    Object.entries(fields_record).map(([fieldname, value]) =>\n      frappe.model.set_value(doctype_to_use, frm.name, fieldname, value)\n    )\n  );\n};\n\nagt.utils.table.row.delete_one = async function(_form: any, child_doctype: string, docname: string) {\n  frappe.model.clear_doc(child_doctype, docname);\n};\n\nagt.utils.table.row.get_one = function<T>(form: any, child_doctype: string, filters: Record<string, any>): T | undefined {\n  const snake_case_doctype = agt.utils.text.to_snake_case(child_doctype);\n  const childTable = form.doc[snake_case_doctype] as unknown as Array<Record<string, any>>;\n  if (!childTable) return;\n  return childTable.find(row => {\n    for (const [k, v] of Object.entries(filters)) {\n      if (row[k] !== v) return false;\n    }\n    return true;\n  }) as T | undefined;\n};\n\nagt.utils.table.row.get_last = function<T>(form: any, child_doctype: string): T | undefined {\n  // Convert to snake_case if not already in that format\n  const snake_case_doctype = agt.utils.text.to_snake_case(child_doctype);\n\n  const childTable = form.doc[snake_case_doctype];\n  if (!childTable) return;\n\n  return childTable[childTable.length - 1] as T | undefined;\n};\n\nagt.utils.table.row.find = function(\n  form: any,\n  child_doctype: string,\n  filters: { or?: Record<string, any>; and?: Record<string, any> }\n) {\n  const snake_case_doctype = agt.utils.text.to_snake_case(child_doctype);\n  const childTable = form.doc[snake_case_doctype] as unknown as Array<Record<string, any>>;\n  if (!childTable) return [];\n  return childTable.filter(row => {\n    if (!filters.and && !filters.or) return false;\n    \n    let andPassed = true;\n    let orPassed = false;\n    \n    if (filters.and) {\n      for (const [k, v] of Object.entries(filters.and)) {\n        if (row[k] !== v) {\n          andPassed = false;\n          break;\n        }\n      }\n    }\n    \n    if (filters.or) {\n      for (const [k, v] of Object.entries(filters.or)) {\n        if (Array.isArray(v) && v.includes(row[k])) {\n          orPassed = true;\n          break;\n        }\n        if (row[k] === v) {\n          orPassed = true;\n          break;\n        }\n      }\n    } else {\n      orPassed = true; // If there are no OR filters, consider as true\n    }\n    \n    return andPassed && orPassed;\n  });\n};\n\nagt.utils.table.row.update_last = async function(\n  form: any,\n  child_doctype: string,\n  fields_record: Record<string, string | number | null>\n) {\n  const lastRow = agt.utils.table.row.get_last(form, child_doctype);\n  if (!lastRow) return;\n  await agt.utils.table.row.update_one(lastRow as any, fields_record);\n};\n\nagt.utils.table.is_sync = async function(current: any, remote: any, docname: any, workflowStateField?: string): Promise<boolean> {\n  if (current.length !== remote.length) return false;\n\n  const currentMap = new Map(current.map((row: any) => [row[docname], row]));\n  const remoteMap = new Map(remote.map((r: any) => [r.name, r]));\n\n  // Verify if all current documents exist in remote and vice versa\n  const allDocsExist = current.every((row: any) => remoteMap.get(row[docname]))\n    && remote.every((row: any) => currentMap.has(row.name));\n\n  if (!allDocsExist) return false;\n\n  if (workflowStateField) {\n    return !remote.some((remoteItem: any) => {\n      const currentItem = currentMap.get(remoteItem.name);\n      return currentItem && (currentItem as any)[workflowStateField] !== remoteItem.workflow_state;\n    });\n  }\n  return true;\n};\n\nagt.utils.table.set_custom_properties = async function(frm: any, options: any, fieldname: string, add_row_label?: string, default_values?: Record<string, any>[], apply_only_first?: boolean): Promise<void> {\n  // if (!frm?.doc) return;\n  const elementsToHide = {\n    hide_add_row: '.grid-add-row',\n    hide_remove_row: '.grid-remove-rows',\n    hide_remove_all_rows: '.grid-remove-all-rows',\n    hide_row_check: '.grid-row-check',\n    hide_append_row: '.grid-append-row',\n    hide_shortcuts: '.grid-shortcuts',\n    hide_check: '.grid-body .grid-row .grid-row-check',\n    hide_grid_delete_row: '.grid-delete-row',\n    hide_grid_move_row: '.grid-move-row',\n  };\n\n  const field = frm.fields_dict[fieldname];\n  if (!field?.grid?.wrapper) return;\n\n  // Function to apply default values to a new row\n  const applyDefaultValues = (rowDoc: any, rowIndex: number) => {\n    if (!default_values || !Array.isArray(default_values)) return;\n\n    // Se h\u00E1 valores padr\u00E3o definidos\n    if (default_values.length > 0) {\n      // Se h\u00E1 m\u00FAltiplas op\u00E7\u00F5es de valores padr\u00E3o, usa o \u00EDndice da linha para determinar qual usar\n      // ou usa o \u00FAltimo conjunto se o \u00EDndice exceder o array\n      const defaultSet = default_values[Math.min(rowIndex, default_values.length - 1)] || default_values[0];\n\n      // Aplica os valores padr\u00E3o ao documento da linha\n      if (defaultSet) {\n        Object.entries(defaultSet).forEach(([key, value]) => {\n          if (!(key in rowDoc) || rowDoc[key] === undefined) {\n            rowDoc[key] = value;\n          }\n        });\n      }\n    }\n  };\n\n  // Function to apply visibility settings\n  const applyVisibilitySettings = () => {\n    Object.entries(elementsToHide).forEach(([option, selector]) => {\n      if (options[option as keyof typeof options] && field.grid && field.grid.wrapper) {\n        field.grid.wrapper.find(selector).hide();\n      }\n    });\n\n    if (options?.hide_config_columns === true) {\n      $(`div[data-fieldname=\"${fieldname}\"] div.col.grid-static-col.d-flex.justify-content-center`).css({ 'visibility': 'hidden' });\n      if (frm.fields_dict[fieldname]?.$wrapper) {\n        frm.fields_dict[fieldname].$wrapper.find('div.col.grid-static-col.d-flex.justify-content-center').css({ 'visibility': 'hidden' });\n      }\n    }\n  };\n\n  // Additional hook to capture specific grid events\n  const gridObj = field.grid as any;\n  if (gridObj && !gridObj._visibility_hooks_attached) {\n    gridObj._visibility_hooks_attached = true;\n\n    // Override add_new_row method if it exists\n    if (typeof gridObj.add_new_row === 'function') {\n      const originalAddNewRow = gridObj.add_new_row;\n      gridObj.add_new_row = function (...args: any[]) {\n        const result = originalAddNewRow.apply(this, args);\n\n        // Aplica valores padr\u00E3o \u00E0 nova linha se foi criada\n        if (result && default_values && Array.isArray(default_values) && default_values.length > 0) {\n          const currentRows = frm.doc[fieldname] || [];\n          const newRowIndex = currentRows.length - 1;\n\n          // Verifica se deve aplicar valores padr\u00E3o baseado no par\u00E2metro apply_only_first\n          const shouldApplyDefaults = apply_only_first === undefined || apply_only_first === false ||\n            (apply_only_first === true && newRowIndex === 0);\n\n          if (newRowIndex >= 0 && currentRows[newRowIndex] && shouldApplyDefaults) {\n            applyDefaultValues(currentRows[newRowIndex], newRowIndex);\n            // Refresh o grid para mostrar os valores aplicados\n            setTimeout(() => {\n              gridObj.refresh();\n            }, 100);\n          }\n        }\n\n        applyVisibilitySettings();\n        return result;\n      };\n    }\n\n    // Override the refresh method if it exists\n    if (typeof gridObj.refresh === 'function') {\n      const originalRefresh = gridObj.refresh;\n      gridObj.refresh = function (...args: any[]) {\n        const result = originalRefresh.apply(this, args);\n        applyVisibilitySettings();\n        return result;\n      };\n    }\n  }\n\n  if (options?.hidden !== undefined) {\n    frm.set_df_property(fieldname, 'hidden', options.hidden ? 1 : 0);\n  }\n\n  if (options?.read_only !== undefined) {\n    frm.set_df_property(fieldname, 'read_only', options.read_only ? 1 : 0);\n  }\n  if (options?.reqd !== undefined) {\n    frm.set_df_property(fieldname, 'reqd', options.reqd ? 1 : 0);\n  }\n  if (options?.label !== undefined) {\n    frm.set_df_property(fieldname, 'label', options.label);\n  }\n  if (options?.description !== undefined) {\n    frm.set_df_property(fieldname, 'description', options.description);\n  }\n  if (options?.cannot_add_rows !== undefined) {\n    frm.set_df_property(fieldname, 'cannot_add_rows', options.cannot_add_rows ? 1 : 0);\n  }\n\n  if (options?.cannot_delete_rows !== undefined) {\n    frm.set_df_property(fieldname, 'cannot_delete_rows', options.cannot_delete_rows ? 1 : 0);\n  }\n\n  if (add_row_label && frm.fields_dict[fieldname] && frm.fields_dict[fieldname].grid) {\n    frm.refresh_field(fieldname);\n    const grid = frm.fields_dict[fieldname].grid;\n    const btn = grid?.wrapper?.find('.grid-add-row');\n    if (btn && btn.length) {\n      btn.text(add_row_label);\n    }\n  }\n};\n\nagt.utils.table.custom_add_row_button = function(frm: any, fieldname: string, label: string) {\n  if (frm.fields_dict[fieldname] && frm.fields_dict[fieldname].grid) {\n    frm.refresh_field(fieldname);\n    const grid = frm.fields_dict[fieldname].grid;\n    const btn = grid?.wrapper?.find('.grid-add-row');\n    if (btn && btn.length) {\n      btn.text(label);\n    }\n  }\n};"],
  "mappings": "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",
  "names": ["_a", "_a", "_a", "_b", "item", "_a", "_b", "field", "_a"]
}
